<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>体育经济分析: 原理与应用</title>
    <meta charset="utf-8" />
    <meta name="author" content="周正卿" />
    <meta name="date" content="2023-04-26" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <script src="libs/kePrint/kePrint.js"></script>
    <link href="libs/lightable/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# 体育经济分析: 原理与应用
]
.subtitle[
## 单元4: 在体育中从相关到因果
]
.author[
### 周正卿
]
.date[
### 26 April 2023
]

---



class: title-slide-section,center, middle, inverse

# 大纲

---
### 大纲

- Level 1
  - 一个例子
- Level 2
  - 基本概念
- Level 3
  - 具体实战

---
### 什么是计量经济学

- Econometrics
- 计量经济学只是统计学的经济学版本吗？

  - 经济学 .mono[+] 统计学技巧 .mono[=] 计量经济学
  - 使用统计学的技巧（工具包），并将其应用于与经济学中的问题和现象有关的问题。

- 相关性足够有趣，为什么更偏好因果？
  - 预知某项干预/政策对感兴趣变量的影响结果。
  - 资源是有限的，而干预措施是要花钱的。

---
### 例子：球队胜率与上座率

假设联盟经理想知道哪些因素对球队上座率最重要。

- 一个方法是用平均观众人数反映上座率现实情况，但是它无法反映变量间的关系

- 通常我们认为**期望**球队获胜越多，观众就越多。用上座率ATT作为因变量，获胜率WPCT作自变量。之所以ATT是因变量，因为它取决于胜率。WPCT作自变量，是我们可以**操纵的变量**，往往不依赖于影响ATT中的其他变量： `\(ATT=f(WPCT)\)` 

- 根据常识，我们可以**理论假设** `\(\frac{\partial ATT}{\partial WPCT} \gt 0\)`

- **检验**上述观点的最直接方式是**散点图**。但这样无法指导当胜率从0.5提高到0.51时，上座率会增加多少。提高胜率通常意味着要花钱买球员。

- 为了样本数据结合，最简单的方法是将理论模型改写为**可回归的线性表达式**  `\(ATT_i= \beta + \tau \times WPCT_i + \varepsilon_i\)`
  - `\(i\)` 代表每支球队 

---
### 例子：球队胜率与上座率

- 接下来要选择一种**回归方法**，这里采取最广泛使用的**一般最小二乘OLS**对线性表达式进行**拟合**
- 通过限定一些**回归假设**，我们就可以得到 `\(\hat\tau\)` ，然而我们感兴趣的是 `\(\tau\)` , 这两者什么关系?
  - 举个例子：进校门要人脸识别，我们通过闸机的时候，它用我们照片去跟照片库里的我们去匹配。两者匹配好肯定是根据某些算法进行的，当误差缩小到一定范围之后，闸门就会开放。现场照片就是 `\(\hat\tau\)` ，而照片库里的我们就是 `\(\tau\)` ，这个过程就是 **识别（identification）**
  - 这个例子中，我们比较好命，至少有个照片库，但是现实中 `\(\tau\)` 往往是不知道的或者说它存在但是看不到，我们只能通过**理论建构**
- 现在我们有 `\(\hat\tau\)` ，它只少要存在两个方面的意义，统计学（现实）意义和经济学（现实）意义。
  - 统计学意义（statistical significance），需要**统计推断**
  - 经济学意义，需要看**效应值**与**经济学解释**
- 若是 `\(\tau\)` 具有**因果性**，上述过程是**因果推断**

---
### 例子：球队胜率与上座率

.center[ ATT =-2.4536+65.23 * WPCT ]
- 告诉我们WPCT每增加一个单位(+0.001)，就会增加65.23个球迷到场。当把平均值WPCT=0.500代入等式，得到 30.163 或30163 球迷，这是当年的平均上座率
- `\(R^2=0.311\)` 反映**拟合度**(代表胜率能够解释31.1%的上座率波动)，t统计值代表显著性( `\(H_0 = 0,H_1 \ne 0\)`  )
- 但是其余的 68.9% 呢? 说明还有其他很多因素会影响，基于以上结论的决策并没有针对性。
  - 市场规模是一个**干扰因素**。纽约有8500万人，辛辛那提只有30万人 → **控制**
  - 联赛差异（分区）是另一个干扰因素。AL和NL是存在差异的 → **控制**
  - 最关键的，因为这两个因素很有可能会影响球队胜率，若是忽略它们会导致**遗漏变量偏差**，产生所谓的**内生性**问题，导致我们用 `\(\hat\tau\)` 代表 `\(\tau\)` 是**偏误**的
- 我们将可回归的线性表达式改为 `\(ATT_i=\boldsymbol{X} \beta + \tau \times WPCT_i + \varepsilon_i\)`
  - 市场规模与联赛差异进入了 `\(\boldsymbol{X}\beta\)`

---
### 例子：球队胜率与上座率

.center[ATT=-.421+1.174POP-2.014 LEAGUE + 59.31*WPCT
&lt;img src=https://pkuzzq-image.oss-cn-beijing.aliyuncs.com/uPic/WanJH1.png height=230&gt;]

- 练习：系数如何解释？具有如何意义？Dummy(AL=1) vs Continuous
- 讨论：59.31是否具有**因果性**?
- 59.310；17.939；3.31；1.96；0.003；0.005


---
class: title-slide-section, middle, inverse
# 遗漏变量偏误与控制变量
---

增加控制变量可以提高回归估计值的可信度，可以让系数趋向于因果，但但也不控制变量越多越好。为了说明这个道理，引入**遗漏变量偏误**的概念。

.hi-pink[例子：教育回报率]
---
### 遗漏变量偏误公式

- 我们使用遗漏变量偏误公式(Omitted Variable Bias Formula)描述 .hi-slate[当回归包含不同的控制变量时，回归结果之间存在的关系。] 它提供了**长回归方程**和**短回归方程**估计系数之间的联系。
- 将所有控制变量简化为**家庭背景、智力和动机**所组成的控制变量集合，标为 `\(\left( {A}_i \right)\)` 并记为“能力”。在控制了能力后，对工资关于教育水平进行回归的方程就可以写成：

$$
`\begin{align}
  {Y}_{i} &amp;= \alpha + \tau {s}_i + {A}_{i}'\gamma + e_i \tag{1}
\end{align}`
$$
- 其中, `\(\alpha, \tau, \gamma\)` 是总体回归系数（没有跟样本结合）, `\(e_{i}\)` 是回归残差。给定 `\(A_{i}\)`, 如果CIA成立（ `\(e_i\)` 与其他回归元不再相关 ）, 那么系数 `\(\tau\)` 具有因果性。但在实际中, 能力是很难度量的。那么, 假如回归方程（1）遗漏了“能力"，此时回归方程变为：
$$
`\begin{align}
  {Y}_{i} &amp;= \alpha + \beta {s}_i + v_i \tag{2}
\end{align}`
$$

---
### 遗漏变量偏误公式

我们将方程 (2) 称为**短回归方程**, (1) 称为**长回归方程**。
那么**遗漏变量偏误公式 (Omitted Variable Bias Formula)**为：

$$
`\begin{align}
  \hat \beta_{ols} =\dfrac{\mathop{{Cov}} \left( {Y}_{i},\, {s}_i \right)}{\mathop{{Var}} \left( {s}_i \right)} = \tau + \gamma' \delta_{As}
\end{align}`
$$
其中, `\(\delta_{As}\)` 是对 `\(A_{i}\)` 关于 `\(s_{i}\)` 回归得到的系数。

该公式表明：**短回归系数**等于**长回归系数**加上**bias**，等于**遗漏变量效应**乘以**遗漏变量对自变量的回归系数**。

因此，满足以下两个条件，那么长、短回归方程对教育回报率的估计将一样:
 (.hi-slate[a]) 受教育程度与能力大小无关 `\(\left( \delta_{As} = 0 \right)\)` **或者** (.hi-slate[b]) 在控制受教育程度后，能力大小与工资多少无关 `\(\left( \gamma = 0 \right)\)`.
 
---
### 例子(MHE)

&lt;table&gt;
&lt;caption&gt;表 3.2.1  教育回报率(MHE)&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 1 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 2 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 3 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 4 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; 教育程度 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.132 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.131 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.114 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.087 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.007) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.007) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.007) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.009) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; 控制变量 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; None &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; Age Dum. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 2 + Add'l &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3 + AFQT &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

- 在这里，我们有四种增加控制变量的方式，关于工资对上学年限的回归（来自NLSY，美国青年纵向调查）
---
### 例子(MHE)

&lt;table&gt;
&lt;caption&gt;表 3.2.1  教育回报率(MHE)&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 1 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 2 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 3 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 4 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; 教育程度 &lt;/td&gt;
   &lt;td style="text-align:center;color: #e64173 !important;"&gt; 0.132 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.131 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.114 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.087 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;color: #e64173 !important;"&gt; (0.007) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.007) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.007) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.009) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; 控制变量 &lt;/td&gt;
   &lt;td style="text-align:center;color: #e64173 !important;"&gt; None &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; Age Dum. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 2 + Add'l &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3 + AFQT &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

.hi[第1列] 没有控制变量 意味着每额外获得1年教育，工资有13.2%的增长。
---
### 例子(MHE)

&lt;table&gt;
&lt;caption&gt;表 3.2.1  教育回报率(MHE)&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 1 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 2 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 3 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 4 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; 教育程度 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.132 &lt;/td&gt;
   &lt;td style="text-align:center;color: #e64173 !important;"&gt; 0.131 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.114 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.087 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.007) &lt;/td&gt;
   &lt;td style="text-align:center;color: #e64173 !important;"&gt; (0.007) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.007) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.009) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; 控制变量 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; None &lt;/td&gt;
   &lt;td style="text-align:center;color: #e64173 !important;"&gt; Age Dum. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 2 + Add'l &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3 + AFQT &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

.hi[第2列] 控制年龄，意味着每额外获得1年教育，工资有13.1%的增长. 
---
### 例子(MHE)

&lt;table&gt;
&lt;caption&gt;表 3.2.1  教育回报率(MHE)&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 1 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 2 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 3 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 4 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; 教育程度 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.132 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.131 &lt;/td&gt;
   &lt;td style="text-align:center;color: #e64173 !important;"&gt; 0.114 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.087 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.007) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.007) &lt;/td&gt;
   &lt;td style="text-align:center;color: #e64173 !important;"&gt; (0.007) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.009) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; 控制变量 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; None &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; Age Dum. &lt;/td&gt;
   &lt;td style="text-align:center;color: #e64173 !important;"&gt; 2 + Add'l &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3 + AFQT &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

.hi[第3列] ，第2列控制变量再加上父母教育和自身人口学特征， 意味着每额外获得1年教育，工资有11.4%的增长。
---
### 例子(MHE)

&lt;table&gt;
&lt;caption&gt;表 3.2.1  教育回报率(MHE)&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 1 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 2 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 3 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 4 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; 教育程度 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.132 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.131 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.114 &lt;/td&gt;
   &lt;td style="text-align:center;color: #e64173 !important;"&gt; 0.087 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.007) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.007) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.007) &lt;/td&gt;
   &lt;td style="text-align:center;color: #e64173 !important;"&gt; (0.009) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; 控制变量 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; None &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; Age Dum. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 2 + Add'l &lt;/td&gt;
   &lt;td style="text-align:center;color: #e64173 !important;"&gt; 3 + AFQT &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

- .hi[第4列] (第3列又控制 AFQT.super[.pink[†]] 分数) 意味着每额外获得1年教育，工资有8.7%的增长。 

.footnote[.pink[†] *AFQT* is *Armed Forces Qualification Test，武装部队资格测验*, 反映能力]
---
### 例子(MHE)

&lt;table&gt;
&lt;caption&gt;表 3.2.1  教育回报率(MHE)&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 1 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 2 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 3 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 4 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; 教育程度 &lt;/td&gt;
   &lt;td style="text-align:center;color: #6A5ACD !important;"&gt; 0.132 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.131 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.114 &lt;/td&gt;
   &lt;td style="text-align:center;color: #e64173 !important;"&gt; 0.087 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;color: #6A5ACD !important;"&gt; (0.007) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.007) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.007) &lt;/td&gt;
   &lt;td style="text-align:center;color: #e64173 !important;"&gt; (0.009) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; 控制变量 &lt;/td&gt;
   &lt;td style="text-align:center;color: #6A5ACD !important;"&gt; None &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; Age Dum. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 2 + Add'l &lt;/td&gt;
   &lt;td style="text-align:center;color: #e64173 !important;"&gt; 3 + AFQT &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

- 可以看到，随着控制变量的增加，从.hi-purple[第1列]到.hi[第4列]教育回报率估计值下降了4.5个百分点（系数下降34%）。

$$
`\begin{align}
  \color{#6A5ACD}{\dfrac{\mathop{{Cov}} \left( {Y}_{i},\, {s}_i \right)}{\mathop{{Var}} \left( {s}_i \right)}} = \color{#e64173}{\tau} + \color{#20B2AA}{\gamma'} \color{#FFA500}{\delta_{As}}
\end{align}`
$$

- .hi[讨论] 为什么？

---
### 遗漏变量偏误公式

- 关注最想要的
OVB公式的使用**并不**要求每一个回归模型都能正确识别因果关系。该公式比较了.hi-purple[短模型]中的回归系数和.hi-pink[长模型]中同一变量的回归系数。.super[.pink[†]]

- **条件独立假设**的重要性

$$
`\begin{align}
  \color{#6A5ACD}{\dfrac{\mathop{{Cov}} \left( {Y}_{i},\, {x}_i \right)}{\mathop{{Var}} \left( {x}_i \right)}} = \color{#e64173}{\tau} + \color{#20B2AA}{\gamma'} \color{#FFA500}{\delta_{Omitted-x_i}}
\end{align}`
$$

- 可信的条件独立假设? → 随机分配

### 坏的控制变量

- 好的控制变量是发生在干预变量.super[.pink[†]]之前或取值不受自变量影响

- 仍以教育收益率为例，个人职业和就业行业就不是好的控制变量。

- 为什么？

???
- 因为个人职业及就业行业往往是教育完成之后个人选择的结果，也就是说，这些变量发生在教育之后，可能受到教育的影响。
- 事实上，教育对职业选择有重要影响，职业和行业往往存在着密切的联系

---
### 例子(MHE)

&lt;table&gt;
&lt;caption&gt;表 3.2.1  教育回报率(MHE)&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 1 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 2 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 3 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 4 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 5 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; 教育程度 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.132 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.131 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.114 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.087 &lt;/td&gt;
   &lt;td style="text-align:center;color: #e64173 !important;"&gt; 0.066 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.007) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.007) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.007) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.009) &lt;/td&gt;
   &lt;td style="text-align:center;color: #e64173 !important;"&gt; (0.010) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; 控制变量 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; None &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; Age Dum. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 2 + Add'l &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3 + AFQT &lt;/td&gt;
   &lt;td style="text-align:center;color: #e64173 !important;"&gt; 4 + Occupation &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

- .hi[第5列]，再控制职业。我们如何解释新的结果？
--

&lt;br&gt;&lt;br&gt;
其实：我们很难解释是何种原因导致了这种下降。

教育水平的系数变小可能仅仅是**选择偏误**的一种表现。因此最好还是用不由教育水平决定的那些变量作为控制变量。

---
### 如何加入控制变量

- 有些控制变量是不合格的，将其加入回归固然可以改变回归系数，但实际上却不该将其加人。**不合格的控制变量**会有严重的问题（比如某些药会导致高血压）。

- **时间原则**是普遍被接受的，也就是**考虑控制变量被决定的时间**。一般来说在自变量被记录之前就决定的变量大部分是好控制。
- 但是某些情况下，要考虑到**人的预期**。比如重大赛事前会超前部署
---
class: title-slide-section,inverse, middle
# 内生性问题

---

- 给定一个多元线性回归模型
$$
`\begin{equation}
Y=\alpha+\beta_{1} X_{1}+\beta_{2} X_{2}+\cdots+\beta_{{k}} X_{k}+ e
\end{equation}`
$$

- 如果干扰项和自变量是相关的, 即

$$
`\begin{equation}
{E}\left(e \mid X_{1}, X_{2}, \cdots, X_{k}\right) \neq 0
\end{equation}`
$$

- 那么可以说这个线性模型存在内生性问题。
  - 无法识别自变量的因果关系系数的情形（常见于经济类文章）
  - 若无法将内生性控制在可信服的水平下，那么回归结果基本是无效的

---

### 来源一: 遗漏变量
考虑模型: `\(INC=\alpha+\beta_{1} E D U+\beta_{2} I Q+e\)`

其中: `\({E}(e \mid EDU, I Q)=0, \operatorname{Cov}(E D U, I Q) \neq 0\)`

若遗漏了自变量 `\(IQ\)`, 即使用 `\(INC=\alpha+\beta_{1} EDU+v\)` 进行回归, 则

`\({E}(v \mid E D U)={E}\left(\beta_{2} I Q+e \mid E D U\right)=\beta_{2} {E}(I Q \mid E D U) \neq 0\)`

---

### 来源二: 测量误差
(1) 自变量存在测量误差

考虑模型:

`$$y_{i}=\beta_{0}+\beta_{1} x_{1 i}+u_{i}$$`

- 满足扰动项 `\(u_i\)` 与自变量均值独立，且与自变量X 的测量误差也独立，且测量误差的均值为零会怎样。考虑含有测量误差的自变量观测值

`$$x_{1 i}^{o b s}=x_{1 i}+v_{i}$$`
- 那么我们估计的方程实际上是
`$$y_{i}=\beta_{0}+\beta_{1} x_{1 i}^{o b s}+e_{i}$$`
其中 `\(e_{i}=\left(u_{i}-\beta_{1} v_{i}\right)\)`

---
### 来源二: 测量误差

- 虽然干扰项 `\({e}\)` 中的 `\({u}\)` 和 `\(v\)` 是相互独立的, 但是里面含了系数 `\(\beta_{1}\)` 。这时, 对于 `\(\beta_{1}\)` 的 OLS 估计为

`$$\begin{aligned}
plim \hat{\beta}_{1}^{O L S} &amp;=\beta_{1}+plim \frac{\sum_{i} \tilde{x}_{1 i}^{o b s} e_{i}}{\sum_{i}\left(\tilde{x}_{1 i}^{o b s}\right)^{2}} \\
&amp;=\beta_{1}+\frac{-\beta_{1} \sigma_{v}^{2}}{\sigma_{\tilde{x}_{1}}^{2}+\sigma_{v}^{2}} \\
&amp;=\beta_{1}\left(\frac{\sigma_{x_{1}}^{2}}{\sigma_{x_{1}}^{2}+\sigma_{v}^{2}}\right)
\end{aligned}$$`

- 自变量存在测量误差时, ****会有内生性问题**
- 自变量存在测量误差时, **系数估计值在绝对值上都会减小**（经济意义不足）, 该偏误叫**衰减偏误**(attenuation bias)，但**不会改变系数估计值符号**
- 偏离程度和 `\(\sigma_{x}^{2} / \sigma_{v}^{2}\)` **信噪比**有关

???
probability limit，概率极限

---

### 来源二: 测量误差
(2) 因变量存在测量误差
.tiny[
$$
`\begin{equation}
Y^{*}=\beta_{0}+\beta_{1} X^{*}+e, \quad {E}\left(e \mid X^{*}\right)=0
\end{equation}`
$$
当因变量 `\(Y^{*}\)` 存在测量误差，即 `\(Y=Y^{*}+u\)` ，同时
$$
`\begin{equation}
\operatorname{Cov} \left(u, X^{*}\right)=0, \quad
\operatorname{Cov} \left(u, Y^{*}\right)=0, \quad
{E} \left(u \mid X^{*}\right)=0
\end{equation}`
$$
此时模型变成
$$
`\begin{gathered}
Y=\beta_{0}+\beta_{1} X^{*}+e+u=\beta_{0}+\beta_{1} X^{*}+v \\
v=e+u
\end{gathered}`
$$

$$
`\begin{aligned}
&amp;\operatorname{Cov}\left(X^{*}, v\right) \\
&amp;=\operatorname{Cov}\left(X^{*}, e+u\right) \\
&amp;=0
\end{aligned}`
$$
]

- 当因变量存在测量误差时, **不会造成内生性问题**
- 干扰项(噪音)变大，导致**回归结果显著性下降**(现实中必须要排除掉的不显著原因，但系数估计是一致的)


---

### 来源三: 互为因果

若因变量与自变量互为因果关系，即任何一方都可以作对方的自变量。

$$
`\begin{align}
&amp;Y_{1}=\beta_{1} X_{1}+\phi_{1} Y_{2}+e_{1}  \tag{1} \\
&amp;Y_{2}=\beta_{2} X_{2}+\phi_{2} Y_{1}+e_{2}  \tag{2}
\end{align}`
$$

$$
`\begin{gathered}
{E}\left(e_{i} \mid X_{1}, X_{2}\right)=0 ; \quad i=1,2 \quad ;
\operatorname{Cov}\left(e_{1}, e_{2}\right)=0
\end{gathered}`
$$
- 将式（2）代入式（1）中,可以得到
$$
`\begin{align}
Y_{1}=\frac{\beta_{1}}{1-\phi_{1} \phi_{2}} X_{1}+\frac{\beta_{2} \phi_{1}}{1-\phi_{1} \phi_{2}} X_{2}+\frac{e_{1}}{1-\phi_{1} \phi_{2}}+\frac{e_{2} \phi_{1}}{1-\phi_{1} \phi_{2}} \tag{3}
\end{align}`
$$
---

### 来源三: 互为因果

- 由式（3）
$$
`\begin{align}
&amp;\operatorname{Cov}\left(Y_{1}, e_{2}\right) \\
&amp;=\operatorname{Cov}\left(\frac{\beta_{1}}{1-\phi_{1} \phi_{2}} X_{1}+\frac{\beta_{2} \phi_{1}}{1-\phi_{1} \phi_{2}} X_{2}+\frac{e_{1}}{1-\phi_{1} \phi_{2}}+\frac{e_{2} \phi_{1}}{1-\phi_{1} \phi_{2}}, e_{2}\right) \\
&amp;=\operatorname{Cov}\left(\frac{e_{2} \phi_{1}}{1-\phi_{1} \phi_{2}}, e_{2}\right) \\
&amp;=\frac{\phi_{1}}{1-\phi_{1} \phi_{2}} \operatorname{Var}\left(e_{2}\right) \neq 0
\end{align}`
$$

- 所以模型 (2) 存在内生性问题（对简化式2进行回归）, 模型 (1) 同理可证

---
class: title-slide-section,inverse,middle
# 如何去找“真相”

---
- 大部分时候我们存着立场、偏见、固念和坐标。可是我们还能不能用别人的观点帮助自己了解这个世界?
- 看见为了相信。to see is to believe
- 在真实世界中，绝大多少只是看到我们相信。but you see what you believe
- 而且你只相信你希望的得到的真相 and you believe what you hope to be true

- p → q == -q → -p
- p → q != q → p
- （A &amp; B &amp; C &amp; D）→ 显著 == 不显著 → （-A ^ -B ^ -C ^ -D）
- 怎么办？→ 去猜
- 直接猜 P(A) 很困难，所以去猜 P(A|B)=P(A&amp;B)/P(B) 
- 这时候就需要看案例的背景资料和文献，去寻找更多信息，来发现潜在B的可能性，去减少犯错的可能性

---
### 理论、分布与样本

&lt;br&gt;
![BigPicture](https://pkuzzq-image.oss-cn-beijing.aliyuncs.com/uPic/BigPicture.png)

- Data .mono[--&gt;] Facts .mono[--&gt;] Model .mono[--&gt;] Knowledge

---
### 条件分布 (Conditional Distribution)
- 通常关心两个变量的关系
- 观察**条件期望**是最直接、简单办法
- 一般假设我们最感兴趣的 `\(Y\)` 与 `\(X\)` 是随机变项（量）.
    - `\(Y\)` 是因变量（因变量|因变量|被解释变量）; `\(X\)` 是自变量（自变量|干预变量|解释变量）. 
    - 是随机变量就会有概率分布，而最常见的是**正态分布**

---
### 例子：想知道工资与性别的关系

- 工资对数的条件均值可以写成如下形式：

$$ E[ log(wage) \mid gender = man ] = 3.05 $$

$$ E[ log(wage) \mid gender = woman ] = 2.81 $$
若是我们还好奇在种族与工资的关系，还可以增加新的条件、
$$ E[\log (wage ) \mid gender =\operatorname{man}, race = white]=3.07 $$
$$ E [\log ( wage ) \mid gender = woman, race = black ]=2.73 $$

---
### 条件密度函数
- 离散形式： `$$P(y|x)=\frac{P(y,x)}{P(x)}$$` 其中 `\(P(x)=\sum_{i=1}^{N}P(y_{i},x)\)`

- 条件密度相当于联合密度 `\(f(y, x)\)` 在保持x不变情况下的随机化“切片”

---
### 条件密度函数

 **为什么**用联合概率分布函数和联合密度函数来捕捉两个变量的关系?

.middle[
.center[
&lt;img src="figs/logWage_Exp.png" height="450"&gt;
]
]
---
### 条件期望函数的误差项

.pull-left[
- Conditional Expectation Function Error （CEFE）
$$ e = Y - E(Y|X) = Y - m(x) $$
    - `\(X\)` 是随机变量， `\(E(Y|X)\)` 也是随机变量
    - `\(e\)` 是误差项，也是随机变量，具有概率分布
]

.pull-right[
- CEFE优良性质

    1. `\(E(e|X)=0\)`
    1. `\(E(e)=0\)`
    1. 对于随机变量 `\(X\)` 任意函数形式 `\(h(x)\)` , `\(E(h(X)·e)=0\)` → 通常利用该性质进行线性变换

]

---

### CEF与建模的关系


step1: 定义条件期望函数 `\(m(x) = E(Y|X)\)`

step2: 定义条件期望函数的误差项 `\(e = Y - m(x)\)`

推导出：$$Y = m(x) + e$$

因此模型类别由 `\(m(x)\)` 形式决定。

如截距模型，线性模型，Logit模型等。

---
### 基于样本的CEF 

- 期望本身是总体概念（价值观）
- 实际中，我们是基于样本信息推断总体信息，例如用样本均值推断总体期望
- 将CEF写作基于样本的CEF:
`\(E[Y_i \mid {X}_{i}]\)` 

从图形上看CEF...

---
class: clear, center, middle

条件分布 `\({Y}_{i}\)`,  对于8, ..., 22不同教育年限的 `\({X}_{i}=x\)`.



&lt;img src="Lec07_files/figure-html/fig_cef_dist-1.svg" style="display: block; margin: auto;" /&gt;
---
class: clear, middle, center
条件期望函数 `\(\mathop{E}\left[ {Y}_{i}\mid {X}_{i} \right]\)` 其实是这些条件分布的均值

&lt;img src="Lec07_files/figure-html/fig_cef-1.svg" style="display: block; margin: auto;" /&gt;

---
class: clear, middle, center

若只关注条件期望函数 `\(\mathop{E}\left[ {Y}_{i}\mid {X}_{i} \right]\)`...

&lt;img src="Lec07_files/figure-html/fig_cef_only-1.svg" style="display: block; margin: auto;" /&gt;
---
## 实际数据（MHE）

.middle[
.center[
&lt;img src="figs/MHE-CEF.png" height="500"&gt;
]
]

---

### 手动操作：研究问题 .mono[--&gt;] .pink[CEF] 

CEF基于数据出发，对于理解变量间至关重要，但经验研究的第一问题是如何将理论结果转换为实证模型， `\({E}\left[ {工资}_i \mid {运动技能}_i \right]\)` :

- step 1：选取 `\(Y\)` 与 `\(X\)` (从研究问题出发)

- step 2：在总体中重复抽样，获得样本

- step 3：对 `\(X\)` "切片" ，获得 `\(Y \mid X=x\)` 的 条件密度和条件分布 

- step 4：制作联合密度表格  `\(P(Y=y , X=x)\)`

- step 5：计算边缘密度 `\(P(X=x)\)`

- step 6：制作条件密度表格 `\(P(Y \mid X=x) = \frac{P(Y=y , X=x)} {P(X=x)}\)`

- step 7：计算条件期望 `\(E(Y \mid X=x)\)` 
---
###  CEF的性质1

.hi.pink[分解结构清楚:] CEF将观测的因变量分解成两部分

$$
`\begin{align}
  {Y}_{i} = \color{#e64173}{\mathop{E}\left[ {Y}_{i}\mid {X}_{i} \right]} + \color{#6A5ACD}{e_i}
\end{align}`
$$

1. 被 `\(\color{#e64173}{{X}_{i}}\)` 解释的部分(_i.e._, CEF `\(\color{#e64173}{\mathop{E}\left[ {Y}_{i} \mid {X}_{i} \right]}\)`)
&lt;br&gt;
1. 具有特殊性质的干扰项&lt;sup&gt;.pink[†]&lt;/sup&gt;
&lt;br&gt;&lt;br&gt; i.  `\(\color{#6A5ACD}{e_i}\)` 均值独立于  `\({X}_{i}\)`, _i.e._, `\(\mathop{E}\left[ \color{#6A5ACD}{e_i} \mid {X}_{i} \right] = 0\)`
&lt;br&gt; ii.  `\(\color{#6A5ACD}{e_i}\)` 与 `\({X}_{i}\)`的任何函数不相干


.footnote[.pink[†] 回忆之前的例子]

---
###  CEF的性质2
.hi.pink[ANOVA 定理:]

无条件方差与条件方差的关系：可将因变量 `\(Y_i\)` 方差分解为两部分

$$
`\begin{align}
  \mathop{{Var}} \left( {Y}_{i} \right) =  \mathop{E}\left[ \mathop{{Var}} \left( {Y}_{i} \mid {X}_{i} \right) \right]+ \mathop{{Var}} \left( \color{#e64173}{\mathop{E}\left[ {Y}_{i} \mid {X}_{i} \right]} \right) 
\end{align}`
$$
 
1. 组内方差(的均值)(within group variance)。每个"等级"内Y的分布的方差的期望值(均值)。

2. 组间方差(across group variance)。条件期望值在"等级"间的分布的方差

解释为：因变量的变动 = CEF的方差(CEF可以解释) .mono[+] 干扰项的方差(CEF无法解释)

---
###  CEF的性质3

.hi.pink[良好预测:]  `\(\mathop{m}\left( {X}_{i} \right)\)` 为 `\({X}_{i}\)` 任意形式函数, CEF是最小均方误差（**性质5**）
$$
`\begin{align}
  \color{#e64173}{\mathop{E}\left[ {Y}_{i} \mid {X}_{i} \right]} = \underset{\mathop{m}\left( {X}_{i} \right)}{{arg min}}\enspace \mathop{E}\left[ \left( {Y}_{i} - \mathop{m}\left( {X}_{i} \right) \right)^2 \right]
\end{align}`
$$
CEF是给定 `\({X}_{i}\)` 能够预测 `\({Y}_{i}\)` 最好预测方式.


.qa[*注意*]
 `\(m\)` 可以是任意形式函数（包含非线性），但我们偏好形式简单、解释力强的模型 → **线性投影函数（LPF）**

为什么不是线性CEF，而是LPF呢? 线性CEF也是常见的线性回归模型(linear regression model)。其中一个原因是 `\(m(x1,x2)\)` 完整线性CEF为 `\(m\left(x_{1}, x_{2}\right)=x_{1} \beta_{1}+x_{2} \beta_{2}+x_{1}^{2} \beta_{3}+x_{2}^{2} \beta_{4}+x_{1} x_{2} \beta_{5}+\beta_{6}\)`  

---
### 为什么是LPF而不是CEF？

CEF是具有好的预测性质，那么什么是“好”的**准则**？

定义**损失函数(loss function)**,  表达为常用的二次型形式：

$$ L(Y, g(x))=(Y-g(x))^{2} $$
其中 `\(L(·)\)` 是r.v.，取期望得**均值平方误差（mean squared error，MSE）**，简称**均方误**
$$ R(Y, g(x)) = E[L(Y, g(x))] = E[(Y-g(x))^{2}] $$

---
### 为什么是LPF而不是CEF？
 
- LPF是MSE最小的线性函数:

$$
`\begin{align}
  \beta = \underset{b}{{arg min}}\thinspace \mathop{E}\left[ \left( {Y}_{i} - {X}_{i}'b \right)^2 \right]
\end{align}`
$$

- 依据一阶条件: `\(\mathop{E}\left[ {X}_{i} \left( {Y}_{i} - {X}_{i}'b \right) \right] = 0\)`得到 `\(b\)` 的最优解 `\(\beta = \mathop{E}\left[ {X}_{i} {X}_{i}' \right]^{-1} \mathop{E}\left[ {X}_{i} {Y}_{i} \right]\)`
- `\(X_{i}^{\prime} \beta\)` 是 `\(Y_i\)` 在 `\(X_i\)` 上的最优线性投影（best linear projection, BLP）, 向量 `\(\beta\)` 是线性投影系数（linear projection coefficient） 
- 根据一阶条件重新构建 `\(E\left[X_{i}\left(Y_{i}-X_{i}^{\prime} \beta\right)\right]=0\)` , 也就是说 `\(Y\)` 的线性投影函数误差(linear projection function error,LPFE )
`\(e_i = Y_i - X_{i}^{\prime} \beta\)` 与 `\(X_i\)` 不相关, 也就是说LPF具有
`\(E(X_i e_i) = 0\)` (矩阵形式为 `\(E[Xe]=0\)` )
的性质.

- .hi.pink[思考：]与CEFE的性质比较

---
### 为什么是LPF而不是CEF？

- LPF是MMSE，CEF也是MMSE。继续使用最小化MSE**准则**：
$$
`\begin{align}
  \beta = \underset{b}{{arg min}}\thinspace \mathop{E}\left[ \left( m({X_i})-{X_i}^{\prime} b \right)^2 \right]
\end{align}`
$$

- 回归与条件期望函数定理（ Regression-CEF Theorem）
- 结论：
  - **LPF同样是CEF的MMSE和BLP**
  - 通常而言，CEF不一定是线性的；但CEF若是线性的, 那么LPF就是CEF

---
class: clear, middle, center
**CEF**

&lt;img src="Lec07_files/figure-html/fig_reg_cef-1.svg" style="display: block; margin: auto;" /&gt;
---
class: clear, center, middle

**LPF**去估计**CEF**

&lt;img src="Lec07_files/figure-html/fig_reg_cef2-1.svg" style="display: block; margin: auto;" /&gt;
---

### 实际数据

.middle[
.center[
&lt;img src=https://pkuzzq-image.oss-cn-beijing.aliyuncs.com/uPic/RgBq9Q.png height="500"&gt;
]
]

---
### 因果关系基于CEF而不是LPF


若CEF是相关关系的 .mono[--&gt;] LPF是相关的

若CEF是因果关系 .mono[--&gt;] LPF是因果的

问题是：怎样获得一个因果的 CEF ？(客观)

.mono[--&gt;]  必须依赖于理论认知(主观) 




---
### 因果关系基于CEF而不是LPF

- .hi-pink[实际上]直接的做法是使用 LPF 进行建模(to see is to believe)
- 由于只有 **线性CEF .mono[=] LPF**，即使使用了**模型设定**正确的LPF，      
一部分信息**先天地**进入到了干扰项 `\(e\)` ，所以**必须**通过假定 **干扰项条件均值独立于自变量** ，即  `\(E(e \mid X) = E(e)=c\)` ，才保证LPF的估计系数是有效的 

---
### 干扰项条件均值独立于自变量
.pull-left[

假设 LPF： `\(INC = \alpha + \beta_1 EDU + \beta_2 IQ + e\)`  


&lt;img src=https://pkuzzq-image.oss-cn-beijing.aliyuncs.com/uPic/drGBU8.png &gt;
]

.pull-right[
- **有向无环图**(directed acyclic graph)
- 实心-可观测；空心-不可观测；单向箭头-因果关系；无法递归
- EDU .mono[-&gt;] INC 直接因果路径
- EDU .mono[&lt;-] IQ .mono[-&gt;] INC 混淆路径1
- EDU .mono[&lt;-] e  .mono[-&gt;] INC 混淆路径2
- 右图：干扰项条件均值独立于自变量
- 左图：即便控制了IQ无效
]
---
### 干扰项条件均值独立于自变量

-  `\(E(e \mid EDU, IQ) = E(e)=c\)` 意味着：给定我们班{EDU = 研究生, IQ = 高} 干扰项的平均值一样(c)，假如性格（不可观测）进入 e，干扰项条件均值独立于自变量成立就表示符合上面两个条件的同学的性格是一样的。
 - 这样，若EDU与IQ其中一个变化，另一不变，收入的条件平均值变化就可以归因于其中那个变化了的条件，获得“净”的因果效应。
- 因此，LPF中的系数 `\(\beta_1\)` 和 `\(\beta_2\)` 就是 EDU 和 IQ 对 INC 的因果效应。
- 将 `\(E(e \mid EDU, IQ) =c\)` 的常数c 并入 LPF常数项，就获得了与CEFE性质一样的 
`\(E(e \mid EDU, IQ) =0\)` 重要假设。 只不过该假设是从 LPF 出发建立的，也就是常在计量教材见到的线性回归方程的**干扰项条件均值为0**的假设。

---
### 干扰项条件均值独立于自变量的理解

- 对于LPF： `\(INC = \alpha + \beta_1 EDU + \beta_2 IQ + e\)`  
- 两边取条件期望, 得到对应的线性CEF:
$$
`\begin{aligned}
&amp;{E}(I N C \mid E D U, I Q) \\
&amp;=\alpha+\beta_{1} E D U+\beta_{2} I Q+{E}(e \mid E D U, I Q) \\
&amp;=\alpha+\beta_{1} E D U+\beta_{2} I Q
\end{aligned}`
$$
- 将线性CEF对EDU求偏导：**偏回归系数**
$$
\frac{d {E}(INC \mid EDU, IQ)}{d EDU}=\beta_{1}
$$

`\(\beta_{1}\)` 表示在IQ固定不变，INC 的期望值（均值）随 EDU 如何变化。 
---
### 因果关系基于CEF而不是LPF

若 `\(E(e \mid EDU, IQ) \neq 0\)` , 干扰项的存在如何影响因果关系的估计?

假设只观测到了INC和EDU, 将 LPF 写作：

`$$I N C=\alpha+\beta_{1} E D U+\varepsilon, \quad \varepsilon=\beta_{2} I Q+e$$`
此时:

`$${E}(\varepsilon \mid E D U)={E}(\beta_{2} I Q+{e} \mid EDU)=\beta_{2}{E}(IQ \mid EDU) \neq 0$$`

此时的LPF为:

$$
I N C=\alpha+\beta_{1} E D U+\varepsilon,\quad {E}(\varepsilon \mid E D U) \neq 0
$$

---
### 因果关系基于CEF而不是LPF

- 假如此时我们错误地把 LPF 当成了正确的、具有因果关系的线性CEF，
- 实际上相当于理解为 我们建构的模型 LPF.super[*]： `\(I N C=\gamma_{0}+\gamma_{1} E D U+u, \quad {E}(u \mid E D U=0)\)` 
的对应的"具有因果关系"（其实是相关关系）CEF.super[*]： `\(E(I N C \mid E D U)=\gamma_{0}+\gamma_{1} E D U\)` 
- 求偏导：
$$ \frac{d {E}(I N C \mid E D U)}{d E D U}=\gamma_{1}$$

- `\(\gamma_{1}\)` 反映了INC 的期望值随EDU如何变化, 但并没有控制IQ不变。

---
### 因果关系基于CEF而不是LPF

计算 `\(\gamma_{1}\)` 和 `\(\beta_{1}\)` 的关系:
$$
`\begin{aligned}
&amp;{E}(I N C \mid E D U) \\
&amp;={E}\left(\alpha+\beta_{1} E D U+\beta_{2} I Q+{e} \mid E D U\right) \\
&amp;=\alpha+\beta_{1} E D U+\beta_{2} {E}(I Q \mid E D U)
\end{aligned}`
$$
- 对EDU求导:
`$$\frac{d {E}(I N C \mid E D U)}{d E D U}=\beta_{1}+\beta_{2} \frac{d {E}(I Q \mid E D U)}{d E D U}$$`
即 
`$$\gamma_{1}=\beta_{1}+\beta_{2} \frac{d {E}(I Q \mid E D U)}{d E D U}$$`
---
### 反映相关关系的CEF

- 假设受教育程度于智商之间存在线性相关关系: 
`$${E}(I Q \mid E D U)=\phi_{0}+\phi_{1} E D U$$`
即
`$$\frac{d {E}(I Q \mid E D U)}{d E D U}=\phi_{1}$$`
则：
`$$\gamma_{1}=\beta_{1}+\beta_{2} \phi_{1}$$` 

---
### 为什么需要推断?

- **.qa[之前]** 重点关注了CEF与LPF，都代表**总体意义**。刻画总体我们只能通过样本, 通过统计推断的方式进行。
- 将LPF 设定为: `\(Y=X^{\prime} \boldsymbol{\beta}+ e, \quad {E}(e \mid X)=0\)` 
- 展开: `\(Y=\alpha+\beta_{1} X_{1}+\cdots+\beta_{k} X_{k}+e\)`
$$
{E}(Y \mid X)=X^{\prime} \boldsymbol{\beta}
$$
- 利用**最小二乘法**求解系数 `\(\hat{\boldsymbol{\beta}}_{ols}\)` ，就是最小化 `\(Y\)` 与线性投影预测值  `\(\hat{Y} = \boldsymbol{X}^{\prime} \boldsymbol{b}\)` 的残差 `\(\varepsilon = Y - \hat{Y}\)` 的MSE
$$
\hat{\boldsymbol{\beta}}_{ols}=\underset{b}{\operatorname{argmin}} {E}\left[\left(Y-\boldsymbol{X}^{\prime} \boldsymbol{b}\right)^{2}\right]
$$
---
### 为什么需要推断?

- 由一阶条件可得：
`$${E}\left[\boldsymbol{X}\left(Y-\boldsymbol{X}^{\prime} \hat{\boldsymbol{\beta}_{}}\right)\right]=0$$`
- 此条件同等与:
$$
{E}\left[\boldsymbol{X}\left(Y-\boldsymbol{X}^{\prime} \hat{\boldsymbol{\beta}}\right)\right]={E}[\boldsymbol{X} {\varepsilon}]=0
$$
- 由此可见, LS的本质是求解系数 `\(\hat{\boldsymbol{\beta}}_{ols}\)` ，使得自变量 `\(X\)` 与残差 `\({\varepsilon}\)` 不相关
$$
\hat{\boldsymbol{\beta}}_{ols}={E}\left[\boldsymbol{X} \boldsymbol{X}^{\prime}\right]^{-1} {E}[\boldsymbol{X} Y]
$$
---
### 为什么需要推断?

- 将LPF代入上式:
$$
`\begin{aligned}
&amp;\hat{\boldsymbol{\beta}}_{ols}={E}\left[\boldsymbol{X} \boldsymbol{X}^{\prime}\right]^{-1} {E}[\boldsymbol{X} Y]={E}\left[\boldsymbol{X} \boldsymbol{X}^{\prime}\right]^{-1} {E}\left[\boldsymbol{X}\left(\boldsymbol{X}^{\prime} \boldsymbol{\beta}+e \right)\right] \\
&amp;=\boldsymbol{\beta}+{E}\left[\boldsymbol{X} \boldsymbol{X}^{\prime}\right]^{-1} {E}[\boldsymbol{X} e]
\end{aligned}`
$$
其中**由于假设**： `\({E}(e \mid X)=0\)`
- 故 `\({E}[\boldsymbol{X} e]={E}_{\boldsymbol{X}}[{E}(\boldsymbol{X} e \mid \boldsymbol{X})]={E}_{\boldsymbol{X}}[\boldsymbol{X} {E}(e \mid \boldsymbol{X})]=\mathbf{0}\)`
- 故 `\(\hat{\boldsymbol{\beta}}_{ols}=\boldsymbol{\beta}\)`
以上讨论说明, 最小二乘法估计系数 `\(\hat{\boldsymbol{\beta}}_{ols}\)` 就是LPF系数，同样也是线性条件期望函数 `\({E}(Y \mid X)=\)` `\(\boldsymbol{X}^{\prime} \boldsymbol{\beta}\)` 的系数 `\(\boldsymbol{\beta}\)`

---
### 为什么需要推断?

- **干扰项** `\(e\)` 包含了除X外的其他影响Y的因素, 与X是否相关无法检验，通常**靠经验和理论判断**；
- **残差项** `\(\varepsilon\)` 是最小二乘法计算出来的， 总是与X正交。
$$
{E}\left[\boldsymbol{X}\left(Y-\boldsymbol{X}^{\prime} \hat{\boldsymbol{\beta}}\right)\right]={E}[\boldsymbol{X} {\varepsilon}]=0
`$$e 
- 最小二乘只是估计方法.super[.pink[†]]，常见的估计方法还有矩方法、最大似然估计等 
- 总体
`\(\hat{\boldsymbol{\beta}}_{ols}={E}\left[\boldsymbol{X} \boldsymbol{X}^{\prime}\right]^{-1} {E}[\boldsymbol{X} Y]\)` 
- 样本 `\(\hat{\boldsymbol{\beta}}_{ols}=\left(\sum_{i} X_{i} X_{i}^{\prime}\right)^{-1}\left(\sum_{i} X_{i} Y_{i}\right)\)`
 
.footnote[.pink[†]
矩方法(method-of-moments) 。根据大数定律和中心极限定理使用样本矩 `\(\dfrac{1}{n}\sum_i {X}_{i} {X}_{i}'\)` 估计总体矩 `\(\mathop{E}\left[{X}_{i} {X}_{i}' \right]\)`. 还可以使用其他估计方法, _e.g._ `\({Y}_{i}\)` 给定 `\({X}_{i}\)` 去最小化 `\({Y}_{i}\)` 的MSE.
]

---
### 推断的大样本性质
 
1. 统计推断建立在随机变量与样本分布基础上，就是用 `\(\hat{\beta}\)` 去推断真实值(未知) `\({\beta}\)`
1. `\(\hat{\beta}\)` 是一个随机变量，因此具有分布(均值和方差)
1. 在大样本下(n&gt;200)，OLS估计量 `\(\hat{\beta}\)` 是总体回归系数 `\({\beta}\)` 的一致估计（ `\(\operatorname{plim} \hat{\beta}=\beta\)` ）
1. 用样本残差代入中间项得到标准误差称为异方差一致性标准误差或稳健标准误差，STATA中在回归后加上vce(robust)
1.因为异方差是社会科学的常态，所有Angrist和 Pischke认为应该把很多统计工具的**默认值切换到异方差**(heteroskedasticity)。若是CEF是非线性的, 使用LPF就会产生异方差。
.tiny[
`\(\mathop{E}\left[ \left( {Y}_{i} - {X}_{i}'\beta \right)^2 \mid {X}_{i} \right]\)`
&lt;br&gt;  `\(= \mathop{E} \left[ \bigg( \big\{ {Y}_{i} - \mathop{E}\left[ {Y}_{i} \mid {X}_{i} \right] \big\} + \big\{ \mathop{E}\left[ {Y}_{i} \mid {X}_{i} \right] - {X}_{i}'\beta \big\} \bigg)^2 \Bigg| {X}_{i} \right]\)`
&lt;br&gt;  `\(= \mathop{{Var}} \left( {Y}_{i} \mid {X}_{i} \right) + \left( \mathop{E}\left[ {Y}_{i} \mid {X}_{i} \right] - {X}_{i}'\beta \right)^2\)`

即使 `\(\mathop{{Var}} \left( {Y}_{i} \mid {X}_{i} \right)\)` 是常数， 第二项也是异方差。
]

---
### 推断的大样本性质

1. **异方差影响会显著性** 
&gt; ...如果异方差变化很大，比如使标准误上升了30%或者低于传统意义上的标准误.super[.pink[†]](通常会大于)，可能标志着在稳健性计算中存在有限样本偏误。

2. 现代微观实证建立在大样本假定下，已经避免了强的经典假设(正态分布、自变量非随机、线性 CEF、同方差) .

.super[.pink[†]
**标准差(SD)是样本数据的方差的平方根，衡量样本数据的离散程度; 标准误(SE)是样本均值的估计值(是随机变量)的标准差，衡量样本均值的离散程度。实际中用样本均值来推断总体均值，那么样本均值的离散程度（标准误）越大，抽样误差就越大。所以用标准误（SE）来衡量抽样误差的大小，所以统计软件中报告是SE。**
]

---
exclude: true


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": true,
"ratio": "16:10.85"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
