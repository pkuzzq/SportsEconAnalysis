<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>ä½“è‚²ç»æµåˆ†æ: åŸç†ä¸åº”ç”¨</title>
    <meta charset="utf-8" />
    <meta name="author" content="å‘¨æ­£å¿" />
    <meta name="date" content="2023-04-26" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# ä½“è‚²ç»æµåˆ†æ: åŸç†ä¸åº”ç”¨
]
.subtitle[
## å•å…ƒ4: ä½“è‚²ä¸­çš„ç›¸å…³æˆ–å› æœ
]
.author[
### å‘¨æ­£å¿
]
.date[
### 26 April 2023
]

---



class: title-slide-section,center, middle, inverse

# å¤§çº²

---
### å¤§çº²

- Level 1
  - ä¸€ä¸ªä¾‹å­
- Level 2
  - åŸºæœ¬æ¦‚å¿µ
- Level 3
  - å…·ä½“å®æˆ˜

---
class: title-slide-section,inverse,center,middle
# æ½œåœ¨ç»“æœæ¡†æ¶å¸®åŠ©ç†è§£â€œçœŸç›¸â€   

---

### ä¸ªä½“å¤„ç½®æ•ˆåº”

-   `\(Y_{i}\)`: å¯¹ä¸ªä½“çš„ `\(i\)` **è§‚å¯Ÿç»“æœ**, æ¯ä¸ªä¸ªä½“éƒ½æœ‰2ä¸ª**æ½œåœ¨ç»“æœ**
-   `\(D_{i}\)`: äºŒå…ƒ **å¹²é¢„çŠ¶æ€** 

1. `\(\color{#e64173}{{Y}_{i}(1)}\)` .pink[è‹¥] `\(\color{#e64173}{{D}_i = 1}\)`
&lt;br&gt; è¡¨ç¤ºï¼š `\(\color{#e64173}{i}\)`  .pink[ å¹²é¢„åçš„ç»“æœ]


2. `\(\color{#6A5ACD}{{Y}_{i}(0)}\)` .purple[è‹¥] `\(\color{#6A5ACD}{{D}_i = 0}\)`
&lt;br&gt; è¡¨ç¤ºï¼š `\(\color{#6A5ACD}{i}\)`  .purple[æ²¡æœ‰è¢«å¹²é¢„çš„ç»“æœ]


ä¸¤è€…ä¹‹å·®å°±æ˜¯ .hi-orange[ä¸ªä½“å¤„ç½®æ•ˆåº”], 
$$
`\begin{align}
  \color{#FFA500}{\tau_i} = \color{#e64173}{{Y}_{i}(1)} - \color{#6A5ACD}{{Y}_{i}(0)}
\end{align}`
$$

- ä¸ªä½“å¤„ç½®æ•ˆåº”å­˜åœ¨å¼‚è´¨æ€§

---

### å› æœæ¨æ–­çš„æ ¹æœ¬éš¾ç‚¹åœ¨äºåäº‹å®æ— æ³•è§‚æµ‹

.hi-slate[é—®é¢˜æ˜¯] æ— æ³•ç›´æ¥è®¡ç®—: `\(\color{#FFA500}{\tau_i} = \color{#e64173}{{Y}_{i}(1)} - \color{#6A5ACD}{{Y}_{i}(0)}\)`

- æ•°æ®ä¸Šåªèƒ½åŒæ—¶è§‚å¯Ÿæ¯ä¸ªä¸ªä½“çš„ `\((Y_{i},D_{i})\)` 

- æ°¸è¿œæ— æ³•**åŒæ—¶**è§‚ `\({Y}_{i}(0)\)` å’Œ `\({Y}_{i}(1)\)`, å¿…é¡»å€ŸåŠ©**åäº‹å®ï¼ˆconterfactualï¼‰**æ¦‚å¿µ


.mono[--&gt;] **ä¸¤ä¸ªæ½œåœ¨ç»“æœåªèƒ½è§‚æµ‹å…¶ä¸€**ï¼Œè¿™å°±æ˜¯Holland(1986)æå‡ºçš„**å› æœæ¨æ–­çš„æ ¹æœ¬éš¾ç‚¹**

---
### ç³»æ•°çš„é‡æ–°å‘½å

-   **ä¸ªä½“å¤„ç½®æ•ˆåº”ï¼š** `\(\color{#FFA500}{\tau_i} = \color{#e64173}{{Y}_{i}(1)} - \color{#6A5ACD}{{Y}_{i}(0)}\)` 
    -   å…³é”®ç‚¹: **å› äººè€Œå¼‚**
    -   ç”±äºæ½œåœ¨ç»“æœæ ¹æœ¬çŸ›ç›¾è€Œæ°¸è¿œæ— æ³•è·å¾—
    
    
-   ä½œä¸ºæ›¿ä»£è½¬å‘**æ€»ä½“å¹³å‡å¤„ç½®æ•ˆåº” (Average Treatment Effect)**ï¼š ç”¨äºæè¿°å¤„ç½®æ•ˆåº”çš„å¹³å‡æ•ˆæœ
    - `\(ATE=E[{Y}_{i}(1)-{Y}_{i}(0)]\)` ï¼ŒATEåªæ˜¯è¿™äº›å¼‚è´¨æ€§å¹²é¢„çš„å¹³å‡å€¼ã€‚
-   å¹²é¢„ç»„å¹³å‡å¤„ç½®æ•ˆåº”(æœ€å…³æ³¨çš„æ•ˆåº”ï¼Œæ˜¯å¹²é¢„è¡Œä¸ºçš„ç›´æ¥åæœ): 
    - `\(ATT=E[{Y}_{i}(1)-{Y}_{i}(0)|D_{i}=1]\)`
-   æ§åˆ¶ç»„å¹³å‡å¤„ç½®æ•ˆåº”:  
    - `\(ATU=E[{Y}_{i}(1)-{Y}_{i}(0)|D_{i}=0]\)`
-   åå˜é‡æ¡ä»¶å¹³å‡å¤„ç½®æ•ˆåº”:  
    - `\(ATE(x)=E[{Y}_{i}(1)-{Y}_{i}(0)|D_{i}=1,X_{i}=x]\)`
    
---
### ATEä¸ATTã€ATUçš„å…³ç³»

-   æ€»ä½“å¹³å‡å¤„ç½®æ•ˆåº” (ATE)
$$
`\begin{aligned}
A T E &amp;=E\left[Y_{i}(1)-Y_{i}(0)\right] \\
&amp;=E\left[Y_{i}(1)\right]-E\left[Y_{i}(0)\right] \\
&amp;=\omega \times A T T+(1-\omega) \times A T U
\end{aligned}`
$$
- ATEæ˜¯ATTå’ŒATUçš„åŠ æƒå¹³å‡

---
### è§‚å¯Ÿç»“æœ

- ä¸ªä½“æ ¹æ®æ˜¯å¦æ¥å—äº†å¹²é¢„è€Œè¡¨ç°å‡ºæ¥çš„æ½œåœ¨ç»“æœ
- å¯è¡¨ç¤ºä¸ºæ½œåœ¨ç»“æœå’Œå¹²é¢„çŠ¶æ€çš„å‡½æ•°
 `\(Y_{i}=Y_{i}(0)+\left[Y_{i}(1)-Y_{i}(0)\right] \times D_{i}\)`
- `\(D_{i}=0\)` è¡¨ç¤ºä¸ªä½“ `\(i\)` æ²¡æœ‰æ¥å—å¹²é¢„, `\(Y_{i}=Y_{i}(0)\)` 
- `\(D_{i}=1\)` è¡¨ç¤ºæ¥å—äº†å¹²é¢„, `\(Y_{i}=Y_{i}(1)\)` 

---

### æ‰€è°“çš„â€œæœ´ç´ â€ä¼°è®¡é‡

.hi-slate[é—®é¢˜] æ—¢ç„¶ ATEã€ATTå’ŒATUå‡æ— æ³•è·å¾—

&lt;br&gt;.hi-slate[ç®€å•æ–¹æ¡ˆ]:

ç›´æ¥æ¯”è¾ƒ .pink[å¹²é¢„ç»„] `\(\left( \color{#e64173}{{Y}_{i}(1)\mid \color{#e64173}{{D}_{i}=1}} \right)\)` å’Œ .purple[æ§åˆ¶ç»„] å‡å€¼, å³: `\(\left( \color{#6A5ACD}{{Y}_{i}(0)\mid \color{#6A5ACD}{{D}_{i}=0}} \right)\)`.

$$
`\begin{align}
  \mathop{E}\left[ {Y}_{i} \mid \color{#e64173}{{D}_{i}=1} \right] - \mathop{E}\left[ {Y}_{i}\mid \color{#6A5ACD}{{D}_{i}=0} \right]
\end{align}`
$$

---
### 3ç§â€œæœ´ç´ â€ä¼°è®¡åè¯¯å½¢å¼

`\(\mathop{E}\left[ {Y}_{i} \mid \color{#e64173}{{D}_{i}=1} \right] - \mathop{E}\left[ {Y}_{i}\mid \color{#6A5ACD}{{D}_{i}=0} \right]\)`
&lt;br&gt;â€ƒ `\(= \underbrace{\mathop{E}\left[ \color{#e64173}{{Y}_{i}(1)}\mid \color{#e64173}{{D}_{i}=1} \right] - \mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}(0)}\mid \color{#e64173}{{D}_{i}=1} \right]}_{ATT\ ğŸ˜€} + \underbrace{\mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}(0)}\mid \color{#e64173}{{D}_{i}=1} \right] - \mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}(0)}\mid \color{#6A5ACD}{{D}_{i}=0} \right]}_{ATTä¼°è®¡åå·®\ ğŸ˜}\)`
&lt;br&gt;â€ƒ `\(= \underbrace{\mathop{E}\left[ \color{#e64173}{{Y}_{i}(1)}\mid \color{#6A5ACD}{{D}_{i}=0} \right] - \mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}(0)}\mid \color{#6A5ACD}{{D}_{i}=0} \right]}_{ATU\ ğŸ˜€} + \underbrace{\mathop{E}\left[ \color{#e64173}{{Y}_{i}(1)}\mid \color{#e64173}{{D}_{i}=1} \right] - \mathop{E}\left[ \color{#e64173}{{Y}_{i}(1)}\mid \color{#6A5ACD}{{D}_{i}=0} \right]}_{ATUä¼°è®¡åå·®\ ğŸ˜}\)`
&lt;br&gt;â€ƒ `\(= \scriptsize {\underbrace{\omega \times(\mathop{E}\left[ \color{#e64173}{{Y}_{i}(1)}\mid \color{#e64173}{{D}_{i}=1} \right]-\mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}(0)}\mid \color{#e64173}{{D}_{i}=1} \right]) + (1-\omega) \times(\mathop{E}\left[ \color{#e64173}{{Y}_{i}(1)}\mid \color{#6A5ACD}{{D}_{i}=0} \right]-\mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}(0)}\mid \color{#6A5ACD}{{D}_{i}=0} \right])}_{ATE\ ğŸ˜€}}\)` 
&lt;br&gt;â€ƒ `\(+ \scriptsize {\underbrace{\omega \times(\mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}(0)}\mid \color{#e64173}{{D}_{i}=1} \right]-\mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}(0)}\mid \color{#6A5ACD}{{D}_{i}=0} \right])+(1-\omega) \times(\mathop{E}\left[ \color{#e64173}{{Y}_{i}(1)}\mid \color{#e64173}{{D}_{i}=1} \right]-\mathop{E}\left[ \color{#e64173}{{Y}_{i}(1)}\mid \color{#6A5ACD}{{D}_{i}=0} \right])}_{ATEä¼°è®¡åå·®\ ğŸ˜€}}\)`

---
### é€‰æ‹©åè¯¯

- ATEä¼°è®¡åå·® `\(= \omega \times\)` ATTä¼°è®¡åå·® `\(+ (1-\omega)\)` ATUä¼°è®¡åå·® 

    - é€ æˆATE ä¼°è®¡åå·®çš„åŸå› åŒ…å«é€ æˆ ATT å’Œ ATU  ä¼°è®¡åå·®çš„åŸå› 
    
- é€ æˆâ€œæœ´ç´ â€ä¼°è®¡é‡ä¼°è®¡å¤„ç½®æ•ˆåº”äº§ç”Ÿåå·®çš„åŸå› ï¼š

  1. **æ˜¯å¦æ¥å—å¹²é¢„**ä¸æ˜¯éšæœºçš„
  2. åŸå› éƒ½æºäº**æ¥å—å¹²é¢„ä¸å¦**æ˜¯ä¸ªä½“è‡ªæˆ‘é€‰æ‹©çš„åæœï¼Œç§°ä¹‹ä¸º**é€‰æ‹©åè¯¯**ï¼ˆselection biasï¼‰
  
---
### ä¾‹å­ï¼š åƒè¯ .mono[-&gt;] å¥åº·

![y8Xmf9](https://pkuzzq-image.oss-cn-beijing.aliyuncs.com/uPic/y8Xmf9.png)
- â€œä¸Šå¸â€è§†è§’
- é˜´å½±éƒ¨åˆ†ä¸ºè§‚æµ‹ç»“æœï¼Œæœ‰ä¸‹åˆ’çº¿çš„éƒ¨åˆ†ä¸ºæ— æ³•è§‚æµ‹åˆ°çš„åäº‹å®ç»“æœ

---
### ä¾‹å­ï¼š åƒè¯ .mono[-&gt;] å¥åº·

- å¹²é¢„ç»„ï¼š  `\(T1=\mathop{E}\left[ \color{#e64173}{{Y}_{i}(1)}\mid \color{#e64173}{{D}_{i}=1} \right]; \quad T0=\mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}(0)}\mid \color{#e64173}{{D}_{i}=1} \right]ï¼ˆåäº‹å®ï¼‰\)` 
  
- æ§åˆ¶ç»„ï¼š  `\(C0=\mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}(0)}\mid \color{#6A5ACD}{{D}_{i}=0} \right]; \quad C1=\mathop{E}\left[ \color{#e64173}{{Y}_{i}(1)}\mid \color{#6A5ACD}{{D}_{i}=0} \right]ï¼ˆåäº‹å®ï¼‰\)` 

![ueiga0](https://pkuzzq-image.oss-cn-beijing.aliyuncs.com/uPic/ueiga0.png)

---
### ä¾‹å­ï¼š åƒè¯ .mono[-&gt;] å¥åº·

è‹¥çŸ¥é“æ‰€æœ‰ä¸ªä½“çš„æ½œåœ¨ç»“æœ, å°±å¯ä»¥å¾—åˆ°å‡†ç¡®çš„å¹³å‡å¤„ç½®æ•ˆåº”
- ATT `\((\)`æ¥å—å¹²é¢„çš„ä¸ªä½“çš„å¹³å‡å¤„ç½®æ•ˆåº” `\()=T 1-T 0=3.3\)`
- ATU `\((\)`æœªæ¥å—å¹²é¢„çš„ä¸ªä½“çš„å¹³å‡å¤„ç½®æ•ˆåº” `\()=C 1-C 0=3\)`
- ATE `\((\)` æ€»ä½“å¹³å‡å¤„ç½®æ•ˆåº” `\()=\omega \times A T T+(1-\omega) \times A T U\)` `\(=3.18\)`


ä½†åœ¨å®é™…æƒ…å†µä¸­, æ— æ³•è§‚æµ‹åˆ°åäº‹å®ç»“æœã€‚
- â€œæœ´ç´ â€ ä¼°è®¡é‡ `\(=T 1-C 0=2.8\)`
- ATT ä¼°è®¡è¯¯å·® `\(=T 0-C 0=-0.5\)`
- ATU ä¼°è®¡è¯¯å·® `\(=T 1-C 1=-0.2\)`
- ATE ä¼°è®¡è¯¯å·® `\(=\omega \times(T 0-C 0)+(1-\omega) \times(T 1-C 1)\)` `\(=-0.38\)` 

- ä¸‰ç»„æœ‰ä¸åŒç¨‹åº¦çš„åå·®
---

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
.qa[é—®é¢˜ï¼š]æ—¢ç„¶ç”±äºåäº‹å®çš„æ ¹æœ¬é—®é¢˜å­˜åœ¨ï¼Œé€šå¸¸ä½¿ç”¨"æœ´ç´ "ä¼°è®¡é‡åˆä¼šå­˜åœ¨ä¼°è®¡åå·®ï¼Œé‚£ä¹ˆå¦‚ä½•é€šè¿‡è§‚æµ‹æ•°æ®è¯†åˆ«å¤„ç½®æ•ˆåº”?

.hi-pink[å›ç­”ï¼š] é€šè¿‡å®éªŒè®¾è®¡ .mono[--] ä¾‹å¦‚ï¼Œéšæœºåˆ†é… 

---

### éšæœºå®éªŒä»ç†è®ºåˆ°å®æˆ˜

- ç†è§£ä¸€ï¼šæ½œåœ¨ç»“æœç‹¬ç«‹æ€§å‡è®¾ï¼ˆindependence assumptionï¼‰

 `$$\left\{{Y}_{{i}}(1), Y_{i}(0)\right\} \perp D_{i}$$`

- ç†è§£äºŒï¼š**å¯è§‚æµ‹ç‰¹å¾ã€ä¸å¯è§‚æµ‹ç‰¹å¾å’Œå¤„ç½®æ•ˆåº”**å®Œå…¨ç‹¬ç«‹äºæ˜¯å¦æ¥å—å¹²é¢„ï¼Œä¹Ÿå°±æ˜¯è¯´é‚£äº›å¹²æ‰°å› ç´ åœ¨éšæœºåˆ†é…åéƒ½è¦è¢«æ§åˆ¶
  
  - è‹¥æ½œåœ¨ç»“æœå¯ä»¥è¡¨ç¤ºä¸ºå¯è§‚æµ‹ç‰¹å¾ `\(X_{i}\)` ã€ä¸å¯è§‚æµ‹ç‰¹å¾ `\(e_{i}\)` å’Œå¤„ç½®æ•ˆåº” `\(\tau_{i}\)` çš„å‡½æ•°
$$
`\begin{aligned}
&amp;Y_{i}(0)=a+b X_{i}+{e}_{{i}}, D_{i}=0 \\
&amp;Y_{i}(1)=a+\tau_{i}+b X_{i}+{e}_{{i}}, D_{i}=1 \\
&amp;\left(X_{i}, e_{i}, \tau_{i}\right) \perp D_{i}
\end{aligned}`
$$
  - é€šä¿—ç†è§£: å°†æ€»ä½“éšæœºåˆ†ä¸ºå¹²é¢„ç»„å’Œæ§åˆ¶ç»„, ä¸ªä½“çš„ç‰¹å¾åœ¨æ€»ä½“ã€å¹²é¢„ç»„ã€æ§åˆ¶ç»„å‡ä¸€è‡´

---
### éšæœºå®éªŒä»ç†è®ºåˆ°å®æˆ˜

ç ”ç©¶é—®é¢˜æ˜¯ï¼šç­çº§äººæ•°å¯¹å­¦ç”Ÿæˆç»©çš„å½±å“ï¼Ÿ
.pull-left[
&lt;img src="figs/éšæœºåˆ†é….svg" &gt;
]

.pull-right[

- æ€»ä½“éšæœºæŠ½å–å„1000äºº
- å¯è§‚æµ‹ç‰¹å¾ï¼šæ€§åˆ«ã€å¹´é¾„ã€æ•™è‚²ç¨‹åº¦
- ä¸å¯è§‚æµ‹ç‰¹å¾ï¼šä¸ªæ€§ã€å­¦ä¹ åŠ¨åŠ›
- å¤„ç½®æ•ˆåº”ï¼šåœ¨ä¸¤ç»„åˆ†å¸ƒæ²¡æœ‰å·®å¼‚
]
---
### æ½œåœ¨ç»“æœç‹¬ç«‹å‡è®¾åŒ…å«çš„ä¸¤ä¸ªâ€œç‹¬ç«‹â€(1)

- ç‹¬ç«‹æ€§ç»´åº¦1: æœªæ¥å—å¹²é¢„(çš„ä¸ªä½“)çš„æ½œåœ¨ç»“æœç‹¬ç«‹äºå¹²é¢„å˜é‡
 `$$\left\{Y_{i}(0)\right\} \perp D_{i}$$`

    - æ„å‘³ç€, å®ƒçš„å‡å€¼ä¹Ÿå’Œ `\(D_{i}\)` ä¸ç›¸å…³

 `$$\mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}(0)}\mid \color{#6A5ACD}{{D}_{i}=0} \right]=\mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}(0)}\mid \color{#e64173}{{D}_{i}=1} \right]$$`

    - åŒ–ç®€ä¸º: `\({E}\left[Y_{i}(0) \mid {D}_{i}\right]={E}\left[Y_{i}(0)\right]\)`
    
    - è¯¥æ¡ä»¶å°±æ„å‘³ç€ï¼Œ `\({T} 0={C} 0\)` 

- é€šä¿—ç†è§£: å¯ä»¥ç”¨æ§åˆ¶ç»„çš„è§‚æµ‹ç»“æœ `\(C0\)` æ¥è¡¡é‡ä¸å¯è§‚æµ‹çš„åäº‹å®ç»“æœ `\({T}0\)`, æ­¤æ—¶å¹²é¢„ç»„çš„å¹³å‡å¤„ç½®æ•ˆåº”ATTæ— å
`$$T 1-C 0=\underbrace{({T} 1-{T} 0)}_{\text {ATT }}+\underbrace{({T} 0-{C} 0)}_{\text {ATTçš„åå·® }=0}=A T T$$`

---
### æ½œåœ¨ç»“æœç‹¬ç«‹å‡è®¾åŒ…å«çš„ä¸¤ä¸ªâ€œç‹¬ç«‹â€(2)
- ç‹¬ç«‹æ€§ç»´åº¦2: æ¥å—å¹²é¢„(çš„ä¸ªä½“)çš„æ½œåœ¨ç»“æœç‹¬ç«‹äºå¹²é¢„å˜é‡
 `$$\left\{Y_{i}(1)\right\} \perp D_{i}$$`

    - æ„å‘³ç€, å®ƒçš„å‡å€¼ä¹Ÿå’Œ `\(D_{i}\)` ä¸ç›¸å…³

 `$$\mathop{E}\left[ \color{#e64173}{{Y}_{i}(1)}\mid \color{#e64173}{{D}_{i}=1} \right]=\mathop{E}\left[ \color{#e64173}{{Y}_{i}(1)}\mid \color{#6A5ACD}{{D}_{i}=0} \right]$$`

    - åŒç†: `\({E}\left[Y_{i}(1) \mid {D}_{i}\right]={E}\left[Y_{i}(1)\right]\)`
    
    - è¯¥æ¡ä»¶å°±æ„å‘³ç€ï¼Œ `\({C} 1={T} 1\)` 

- é€šä¿—ç†è§£: å¯ä»¥ç”¨å¹²é¢„ç»„çš„è§‚æµ‹ç»“æœ `\(T1\)` æ¥è¡¡é‡ä¸å¯è§‚æµ‹çš„åäº‹å®ç»“æœ `\({C}1\)`, æ­¤æ—¶æ§åˆ¶ç»„çš„å¹³å‡å¤„ç½®æ•ˆåº”ATUæ— å
`$$T 1-C 0=\underbrace{({C} 1-{C} 0)}_{\text {ATU }}+\underbrace{({T} 1-{C} 1)}_{\text {ATUçš„åå·® }=0}=A T T$$`

---
### ä»éšæœºå®éªŒåˆ°å›å½’
&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
ç”±äºRCTå®éªŒæ˜‚è´µä¸”ä»¥äººä¸ºå®éªŒå¯¹è±¡ä¼šå—ä¼¦ç†å®¡æŸ¥å§”å‘˜ä¼šçš„ä¿æŠ¤ã€‚é‚£ä¹ˆå½“ä¸æ˜¯éšæœºåˆ†é…æ—¶å€™ï¼Œèƒ½å¤Ÿä½¿ç”¨"æœ´ç´ "ä¼°è®¡é‡å‘¢ï¼Ÿ

--

.hi-pink[å›ç­”ï¼š] å¯ä»¥ã€‚åªè¦æ½œåœ¨ç»“æœçš„å·®å¼‚æ˜¯ç”±æ˜¯å¦æ¥å—å¹²é¢„å’Œå¯è§‚æµ‹çš„ä¸ªä½“ç‰¹å¾é€ æˆæ—¶ï¼Œå°±å¯ä»¥é€šè¿‡æ§åˆ¶å¯è§‚æµ‹çš„ä¸ªä½“ç‰¹å¾æ¥æ¶ˆé™¤é€‰æ‹©åå·®ã€‚

---
### æ§åˆ¶å¯è§‚æµ‹ç‰¹å¾å¯ä»¥æ¶ˆé™¤é€‰æ‹©åå·®

- è¯ç‰©æ•ˆæœå®éªŒ
    - æœè¯ä¸ªä½“æ™®éå¹´é¾„åå¤§ï¼Œå¹´é¾„å¤§çš„ä¸ªä½“æ™®éçš„æ½œåœ¨å¥åº·çŠ¶å†µå·®
    - å¯¹å¹²é¢„ç»„å’Œæ§åˆ¶ç»„çš„å¹´é¾„è¿›è¡Œåˆ†ç±»ï¼Œæ§åˆ¶å¹´é¾„ä»¥æ¶ˆé™¤ä¸åŒå¹´é¾„æ®µæ½œåœ¨å¥åº·çŠ¶å†µçš„å·®å¼‚ã€‚åŒä¸€ä¸ªå¹´é¾„æ®µï¼Œå¹²é¢„ç»„å’Œæ§åˆ¶ç»„å¯ä»¥çœ‹æˆéšæœºåˆ†é…ï¼Œæ»¡è¶³å‰ä¸€èŠ‚çš„ç‹¬ç«‹æ€§å‡è®¾
.center[
![KQ0CRA](https://pkuzzq-image.oss-cn-beijing.aliyuncs.com/uPic/KQ0CRA.png)
]
- `\(ATT(30)=ATU(30)=ATE(30)=T1(30) - C0(30)\)` 
- `\(ATT(40)=ATU(40)=ATE(40)=T1(40) - C0(40)\)` 
- `\(ATT=P(30 | D = 1 ) Ã— ATT(30) + P (40 | D = 1) Ã— ATT(40)\)` 

---
### æ§åˆ¶å¯è§‚æµ‹ç‰¹å¾åœ¨CMIå‡è®¾ä¸‹æ¶ˆé™¤é€‰æ‹©åå·®

å¯¹äºç»™å®šçš„å¯è§‚æµ‹ç‰¹å¾æ¡ä»¶ `\(X_{i}=x\)` çš„å¹²é¢„ç»„å’Œæ§åˆ¶ç»„
$$
`\begin{aligned}
&amp;A T T(x)=T 1(x)-C 0(x) \\
&amp;A T T=\sum_{x} P(x \mid D=1) \times {ATT}(x)
\end{aligned}`
$$

- åˆ™æœ‰, `\(A T E={E}_{x}[{ATE}(X)]=\sum_{x} P(x) \times ATE(x)\)`

è¯¥å‡è®¾ç§°ä¸º: **æ¡ä»¶å‡å€¼ç‹¬ç«‹å‡è®¾(CMI)**
`\({E}\left[Y_{i}(0) \mid D_{i}=1, X_{i}=x\right]={E}\left[Y_{i}(0) \mid D_{i}=0, X_{i}=x\right]={E}\left[Y_{i}(0)=x\right]\)`
`\({E}\left[Y_{i}(1) \mid D_{i}=1, X_{i}=x\right]={E}\left[Y_{i}(1) \mid D_{i}=0, X_{i}=x\right]={E}\left[Y_{i}(0)=x\right]\)`

- æ»¡è¶³CMIæœ€ç›´æ¥çš„æ–¹å¼æ˜¯æ¡ä»¶éšæœºåˆ†é…, å¦‚ç»™å®š30å²ç¾¤ä½“, ä»ä¸­éšæœºæŠ½å– ä¸€äº›äººæœè¯ã€ä¸€äº›äººä¸æœè¯
- CMIåªèƒ½ä¼°è®¡è¯¥æ¡ä»¶ä¸‹ATE, æ›´å¼ºçš„å‡è®¾æ˜¯**æ¡ä»¶ç‹¬ç«‹å‡è®¾ï¼ˆCIAï¼‰**

---
### æƒ³è¦æ›´å¤šï¼šéœ€è¦æ¡ä»¶ç‹¬ç«‹å‡è®¾ CIA

.note[å®šä¹‰]:

-  åœ¨ `\({X}_{i}\)` çš„æ¡ä»¶ä¸‹,æ½œåœ¨ç»“æœ `\(\left(\color{#6A5ACD}{{Y}_{i}(0)},\, \color{#6A5ACD}{{Y}_{i}(1)} \right)\)` ä¸å¹²é¢„å˜é‡ `\(\color{#e64173}{{D}_{i}}\)` ç‹¬ç«‹(é€‰æ‹©åè¯¯æ¶ˆå¤±), æ•°å­¦å½¢å¼ä¸º:

$$
`\begin{align}
  \def\ci{\perp\mkern-10mu\perp}
  \left\{ \color{#6A5ACD}{{Y}_{i}(0)},\,\color{#6A5ACD}{{Y}_{i}(1)} \right\} \ci  \color{#e64173}{{D}_{i}} | {X}_{i}
\end{align}`
$$
 &lt;br&gt;
é€‰æ‹©åè¯¯ `\(= \mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}(0)} \mid {X}_{i},\, \color{#e64173}{{D}_{i}= 1} \right] - \mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}(0)} \mid {X}_{i},\, \color{#e64173}{{D}_{i}= 0} \right]\)`
&lt;br&gt;.white[é€‰æ‹©åè¯¯] `\(= \mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}(0)} \mid {X}_{i} \right] - \mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}(0)} \mid {X}_{i} \right]\)`
&lt;br&gt;.white[é€‰æ‹©åè¯¯] `\(= 0\)`

???
å‰é¢å‡è®¾æˆ‘ä»¬åªèƒ½è·å¾—ATTï¼Œä½†æ˜¯æƒ³è¦ATEæˆ–è€…ATUå‘¢ï¼Ÿ

---
### æƒ³è¦æ›´å¤šï¼šéœ€è¦æ¡ä»¶ç‹¬ç«‹å‡è®¾ CIA

CIAæ„æ€æ˜¯ï¼šåœ¨æ§åˆ¶æŸäº›åå˜é‡ `\({X}_{i}\)` å, å¹²é¢„æªæ–½çš„åˆ†é…å°±åƒ  .it[.hi-slate[éšæœºåˆ†é…ä¸€æ ·]].

å°†ä¹‹å‰çš„"æœ´ç´ "ä¼°è®¡é‡å†™ä¸ºåœ¨æ§åˆ¶ `\({X}_{i}\)` çš„æ¡ä»¶ä¸‹

$$
`\begin{align}
  &amp;\mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}} \mid {X}_{i},\, \color{#e64173}{{D}_{i}=1} \right] - \mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}} \mid {X}_{i},\, \color{#e64173}{{D}_{i}=0} \right] \\[0.5em]
  &amp;= \mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}(1)} \mid {X}_{i} \right] - \mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}(0)} \mid {X}_{i} \right] \\[0.5em]
  &amp;= \mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}(1)} - \color{#6A5ACD}{{Y}_{i}(0)} \mid {X}_{i} \right]
\end{align}`
$$

RCT + CIA æ‰å®Œæ•´ï¼

---
### å¤šæ¬¡å¹²é¢„å‘¢ï¼ŸCIAæ‰©å±•-å¤šå€¼å¹²é¢„å˜é‡

.hi[ç»§ç»­è€ƒè™‘ï¼š] æ•™è‚²ç¨‹åº¦å¯¹æ”¶å…¥çš„ä¾‹å­

 ç°åœ¨ï¼Œå°†CIAæ‹“å±•åˆ°å¹²é¢„å˜é‡å–å¤šå€¼çš„æƒ…å†µï¼Œæ¯”å¦‚å—æ•™è‚²å¹´æ•°.pink[æ•™è‚²] `\(\left( \color{#e64173}{s_i} \right)\)` å–å€¼ä¸ºæ•´æ•° t `\(\in\left\{ 0,\,1,\,\ldots,\, T \right\}\)`ã€‚ç”±äºå—æ•™è‚²æ°´å¹³å’Œæ”¶å…¥ä¹‹é—´çš„å› æœå…³ç³»å¯èƒ½å› äººè€Œå¼‚ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ä¸ªä½“çš„æ”¶å…¥å‡½æ•°ï¼š
$$
`\begin{align}
  \color{#6A5ACD}{{Y}_{si}} \equiv \mathop{f_i}(\color{#e64173}{s})
\end{align}`
$$
`\(\color{#6A5ACD}{{Y}_{i}(1)}\)` ä¸ºä¸ªä½“ `\(i\)` æ¥å—æ•™è‚²(æ˜¯å¦å¹²é¢„)åçš„æ½œåœ¨ç»“æœ, `\(\color{#6A5ACD}{{Y}_{si}}\)` ä»£è¡¨ä¸ªä½“ `\(i\)` æ¥å— `\(s\)` å¹´æ•™è‚²åä¼šè·å¾—çš„æ½œåœ¨æ”¶å…¥ï¼Œå‡½æ•° `\(\mathop{f_i}(\color{#e64173}{s})\)` å‘Šè¯‰æˆ‘ä»¬ï¼šæ¯ä¸ªäººä»»æ„çš„å—æ•™è‚²æ°´å¹³ `\(s\)` ä¸‹ä¸ªä½“ `\(i\)` å¯èƒ½çš„æ”¶å…¥ï¼Œæ˜¯ä¾æ®æ•™è‚²ä¸æ”¶å…¥çš„ç†è®ºå»ºç«‹çš„ã€‚

æ¢å¥è¯è¯´, `\(\mathop{f_i}(\color{#e64173}{s})\)`  å›ç­”äº†â€œå¦‚æœâ€¦â€¦ï¼Œå°±ä¼šâ€¦â€¦â€è¿™æ ·çš„ä¸€ä¸ªå› æœæ€§é—®é¢˜ã€‚

æ¨¡å‹å»ºæ„å…·æœ‰ä¸€èˆ¬æ€§ï¼Œé€‚ç”¨äºä¸åŒç†è®ºï¼šåœ¨äººåŠ›èµ„æœ¬å’Œæ”¶å…¥ä¹‹é—´å…³ç³»çš„ç†è®ºæ¨¡å‹ä¸­ï¼Œ `\(i\)` æ•™è‚²å›æŠ¥ç‡çš„å‡½æ•°å½¢å¼æ˜¯ä¸åŒçš„ï¼Œå¯èƒ½ç”±ä¸ªä½“è¡Œä¸ºæŸä¸ªç‰¹ç‚¹å†³å®šï¼Œä¹Ÿå¯èƒ½è¢«å¸‚åœºåŠ›é‡å†³å®šï¼Œæˆ–äºŒè€…å…¼è€Œæœ‰ä¹‹ã€‚

---
### å¤šæ¬¡å¹²é¢„å‘¢ï¼ŸCIAæ‰©å±•-å¤šå€¼å¹²é¢„å˜é‡

ä»¥ä¸Šå°† CIA æ‰©å±•åˆ°å¹²é¢„å˜é‡çš„å¤šå€¼æƒ…å½¢(multi-value). 

CIAè¡¨ç¤ºåœ¨ç»™å®šæ§åˆ¶å˜é‡é›†åˆ `\(X_i\)`çš„æ¡ä»¶ä¸‹ï¼Œæ½œåœ¨ç»“æœ `\(\color{#6A5ACD}{{Y}_{si}}\)` å’Œ `\(\color{#e64173}{s_i}\)` æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œåœ¨æ›´ä¸€èˆ¬çš„æ¡ä»¶ä¸‹ï¼ŒCIAå˜ä¸ºâˆ¶

.center[
`\(\color{#6A5ACD}{{Y}_{si}} \ci \color{#e64173}{s_i} \mid {X}_{i}\enspace\)` å¯¹äºæ‰€æœ‰ `\(\color{#e64173}{s}\)`
]

åœ¨RCTä¸­ï¼Œç”±äº `\(s_i\)` æ˜¯åœ¨ç»™å®š `\(X_i\)`  ä¸‹éšæœºåˆ†é…çš„ï¼Œæ‰€ä»¥CIAè‡ªç„¶æˆç«‹ã€‚åœ¨ä½¿ç”¨è§‚å¯Ÿæ•°æ®è¿›è¡Œçš„ç ”ç©¶ä¸­ï¼ŒCIAæ„å‘³ç€ç»™å®š `\(X_i\)`  ä¸‹ `\(s_i\)` â€œå°±åƒè¢«éšæœºåˆ†é…çš„é‚£æ ·å¥½â€ã€‚

---
### å¤šæ¬¡å¹²é¢„å‘¢ï¼ŸCIAæ‰©å±•-å¤šå€¼å¹²é¢„å˜é‡

ç»™å®š `\(X_i\)`  ï¼Œå¤šæ¥å—ä¸€å¹´æ•™è‚²å¸¦æ¥çš„å¹³å‡å¤„ç½®æ•ˆåº”å°±æ˜¯ `\(\mathop{E}\left[ \mathop{f_i}(\color{#e64173}{s}) - \mathop{f_i}(\color{#e64173}{s-1}) \mid {X}_{i} \right]\)` ï¼Œå¤šæ¥å—å››å¹´æ•™è‚²å¸¦æ¥çš„å¹³å‡å¤„ç½®æ•ˆåº”å°±æ˜¯ `\(\mathop{E}\left[ \mathop{f_i}(\color{#e64173}{s}) - \mathop{f_i}(\color{#e64173}{s-4}) \mid {X}_{i} \right]\)` ã€‚

æ•°æ®åªèƒ½å‘Šè¯‰æˆ‘ä»¬ `\(\color{#6A5ACD}{{Y}_{i}} = f_i(\color{#e64173}{s_i})\)` ï¼Œä¹Ÿå°±æ˜¯å½“ `\(\color{#e64173}{s}=\color{#e64173}{s_i}\)` æ—¶çš„ `\(f_i(\color{#e64173}{s_{i}})\)` ã€‚

åœ¨CIA"æŠ¤èº«ç¬¦"ä¸‹ï¼Œç»™å®š `\(X_i\)` ï¼Œä¸åŒæ•™è‚²æ°´å¹³ä¸‹å¹³å‡æ”¶å…¥çš„å·®å¼‚å°±å¯è§£é‡Šä¸ºæ•™è‚²çš„å¤„ç½®æ•ˆåº”ã€‚å› æ­¤å¤šæ¥å—1å¹´æ•™è‚²çš„å¤„ç½®æ•ˆåº”å¯ä»¥å†™ä¸º:
$$
`\begin{align}
  \mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}} \mid {X}_{i},\, \color{#e64173}{s_i = s} \right] - \mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}} \mid {X}_{i},\, \color{#e64173}{s_i = s-1} \right]=
  \mathop{E}\left[ \mathop{f_i}(\color{#e64173}{s}) - \mathop{f_i}(\color{#e64173}{s-1}) \mid {X}_{i} \right]
\end{align}`
$$

å¯¹ä»»ä½•çš„ `\(s\)` éƒ½æˆç«‹ã€‚ä¸‹é¢è¯æ˜ã€‚
---
### å¤šæ¬¡å¹²é¢„å‘¢ï¼ŸCIAæ‰©å±•-å¤šå€¼å¹²é¢„å˜é‡

åœ¨CIAä¸‹ï¼Œç»™å®š `\({X}_{i}\)`, `\(\color{#6A5ACD}{{Y}_{si}}\)` (æ½œåœ¨ç»“æœ) å’Œ `\(\color{#e64173}{s_i}\)` (ç†è§£ä¸ºç”¨è¯çš„å‰‚é‡)æ˜¯ç‹¬ç«‹çš„:

$$
`\begin{align}
\def\ci{\perp\mkern-10mu\perp}
  &amp;\mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}} \mid {X}_{i},\, \color{#e64173}{s_i = s} \right] - \mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}} \mid {X}_{i},\, \color{#e64173}{s_i = s-1} \right] \\[0.5em]
  &amp;=\mathop{E}\left[ \color{#6A5ACD}{f_{i}(s_{i})} \mid {X}_{i},\, \color{#e64173}{s_i = s} \right] - \mathop{E}\left[ \color{#6A5ACD}{f_{i}(s_{i})} \mid {X}_{i},\, \color{#e64173}{s_i = s-1} \right] \\[0.5em] 
  &amp;=\mathop{E}\left[ \color{#6A5ACD}{f_{i}(s)} \mid {X}_{i},\, \color{#e64173}{s_i = s} \right] - \mathop{E}\left[ \color{#6A5ACD}{f_{i}(s-1)} \mid {X}_{i},\, \color{#e64173}{s_i = s-1} \right] \\[0.5em]
  &amp;=\mathop{E}\left[ \color{#6A5ACD}{{Y}_{si}} \mid {X}_{i},\, \color{#e64173}{s_i = s} \right] - \mathop{E}\left[ \color{#6A5ACD}{{Y}_{(s-1)i}} \mid {X}_{i},\, \color{#e64173}{s_i = s-1} \right] \\[0.5em]
  {CIA:} f_{i}(s) \ci s_{i} \mid X_{i} \\[0.5em] 
  &amp;=\mathop{E}\left[ \color{#6A5ACD}{{Y}_{si}} \mid {X}_{i} \right] - \mathop{E}\left[ \color{#6A5ACD}{{Y}_{(s-1)i}} \mid {X}_{i} \right] \\[0.5em]
  &amp;=\mathop{E}\left[ \color{#6A5ACD}{{Y}_{si}} - \color{#6A5ACD}{{Y}_{(s-1)i}} \mid {X}_{i} \right] \\[0.5em]
  &amp;=\mathop{E}\left[ \mathop{f_i}(\color{#e64173}{s}) - \mathop{f_i}(\color{#e64173}{s-1}) \mid {X}_{i} \right]
\end{align}`
$$

CIAä¸‹, ä¸åŒæ•™è‚²æ°´å¹³ä¸‹çš„å¹³å‡æ”¶å…¥çš„å·®å¼‚å¯èƒ½è§£é‡Šä¸ºæ•™è‚²çš„å¤„ç½®æ•ˆæœ

---
### å¤šæ¬¡å¹²é¢„å‘¢ï¼ŸCIAæ‰©å±•-å¤šå€¼å¹²é¢„å˜é‡

.hi-pink[ä¾‹å­] å¯ä»¥æ¯”è¾ƒæ•™è‚²æ°´å¹³ä¸º11å¹´å’Œ12å¹´çš„ä¸ªä½“é—´å¹³å‡æ”¶å…¥çš„å·®åˆ«ï¼Œä»¥æ­¤æ¥äº†è§£é«˜ä¸­æ¯•ä¸šå¸¦æ¥çš„å¹³å‡å¤„ç½®æ•ˆåº”
.big-left[
`\(\mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}} \mid {X}_{i},\, \color{#e64173}{s_i = 12} \right] -   \mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}} \mid {X}_{i},\, \color{#e64173}{s_i = 11} \right]\)`
]
.big-left[
`\(=\mathop{E}\left[ f_i(\color{#e64173}{12}) \mid {X}_{i},\, \color{#e64173}{s_i = 12} \right] -   \mathop{E}\left[ f_i(\color{#e64173}{11}) \mid {X}_{i},\, \color{#e64173}{s_i = 11} \right]\)`
]
.big-left[
`\(=\mathop{E}\left[ f_i(\color{#e64173}{12}) \mid {X}_{i},\, \color{#e64173}{s_i = 12} \right] -   \mathop{E}\left[ f_i(\color{#e64173}{11}) \mid {X}_{i},\, \color{#e64173}{s_i = 12} \right]\)` â€ƒ.grey-light[(CIA)]
]
.big-left[
`\(=\mathop{E}\left[ f_i(\color{#e64173}{12}) - f_i(\color{#e64173}{11}) \mid {X}_{i},\, \color{#e64173}{s_i = 12} \right]\)`
]
.big-left[
`\(=\)` .hi[ç»™å®š] `\(X_{i}\)` .hi[ä¸‹] , .hi[å·²é«˜ä¸­æ¯•ä¸šå­¦ç”Ÿ]å› é«˜ä¸­æ¯•ä¸šå¸¦æ¥çš„å¹³å‡å¤„ç½®æ•ˆåº” 
]
.big-left[
`\(=\mathop{E}\left[ f_i(\color{#e64173}{12}) - f_i(\color{#e64173}{11}) \mid {X}_{i} \right]\)`â€ƒ.grey-light[(å†æ¬¡CIA)]
]
.big-left[
`\(=\)` .hi[ç»™å®š] `\(X_{i}\)` .hi[ä¸‹] , é«˜ä¸­æ˜¯å¦æ¯•ä¸šï¼ˆä¸ºæ¡ä»¶ï¼‰çš„å¹³å‡å¤„ç½®æ•ˆåº”
]

---
### å¤šæ¬¡å¹²é¢„å‘¢ï¼ŸCIAæ‰©å±•-å¤šå€¼å¹²é¢„å˜é‡ï¼ˆä»å¤šæ¡ä»¶åˆ°æ— æ¡ä»¶ï¼‰

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå¯¹ `\(X_i\)` å¯å–çš„æ¯ä¸€ä¸ªå€¼éƒ½æ„é€ äº†ä¸€ä¸ªå¤„ç½®æ•ˆæœ `\(ATE_{X_i=x}\)` ã€‚è¿™æ ·åšçš„ç»“æœæ˜¯åå˜é‡ `\(X_i\)` å–å¤šå°‘å€¼å°±å¯èƒ½ä¼šå­˜åœ¨å¤šå°‘å¤„ç½®æ•ˆæœã€‚

å¯¹ä¸Šé¢çš„ä¾‹å­è€Œè¨€ï¼Œå¦‚æœCIAå‡è®¾æ»¡è¶³ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—ä»»æ„æ¡ä»¶(ç»„åˆ)ä¸‹çš„æ•™è‚²å¹´é™ä¸º12å’Œ11çš„äººçš„å¹³å‡æ”¶å…¥çš„å·®æ¥å¾—åˆ°è¯¥æ¡ä»¶ä¸‹çš„å¤„ç½®æ•ˆåº”ã€‚ä¾‹å¦‚ `\(X_i\)` åŒ…å«çš„å˜é‡ä¸ºï¼ˆSexï¼ŒAgeï¼‰ã€‚é‚£ä¹ˆï¼ŒSex=1è¡¨ç¤ºå¥³æ€§ï¼ŒAgeçš„å–å€¼èŒƒå›´ä»20-60ã€‚åœ¨ä¸Šé¢çš„æ¡ä»¶ä¸‹ï¼Œä¸€ä¸ªå› æœå…³ç³»å¯ä»¥è¡¨ç¤ºä¸ºï¼š

- `\(E[f_i(\color{#e64173}{12})-f_i(\color{#e64173}{11}) \mid\)` Sex `\(=1\)`, Age `\(=20è‡³30]\)` è¡¨ç¤ºå¹´é¾„æ®µä¸º20~30å²çš„å¥³æ€§ï¼Œé«˜ä¸­æ¯•ä¸šæ¯”é«˜ä¸­è‚„ä¸šçš„å¹³å‡æ•™è‚²å›æŠ¥æ°´å¹³ã€‚
- `\(E[f_i(\color{#e64173}{12})-f_i(\color{#e64173}{11}) \mid\)` Sex `\(=0\)`, Age `\(=65å²ä»¥ä¸Š]\)` è¡¨ç¤º65å²ä»¥ä¸Šçš„ç”·æ€§ï¼Œé«˜ä¸­æ¯•ä¸šæ¯”é«˜ä¸­è‚„ä¸šçš„å¹³å‡æ•™è‚²å›æŠ¥æ°´å¹³ã€‚
- èƒ½ä¸èƒ½ç”¨ç›¸å¯¹ç»¼åˆçš„æŒ‡æ ‡æ¦‚æ‹¬ä¸€ç³»åˆ—å¤„ç½®æ•ˆåº”ï¼Ÿ

---

### å¤šæ¬¡å¹²é¢„å‘¢ï¼ŸCIAæ‰©å±•-å¤šå€¼å¹²é¢„å˜é‡ï¼ˆä»å¤šæ¡ä»¶åˆ°æ— æ¡ä»¶ï¼‰

.qa[Q] é‚£ä¹ˆ.hi-pink[æ— æ¡ä»¶]çš„é«˜ä¸­æ¯•ä¸šç›¸å¯¹äºé«˜ä¸­è‚„ä¸šçš„å¹³å‡å¤„ç½®æ•ˆåº”æ˜¯ä»€ä¹ˆ?

.qa[A] æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿­ä»£æœŸæœ›å®šç†å¯¹ä¸åŒçš„å› æœæ•ˆæœè¿›è¡Œç»¼åˆã€‚é¦–å…ˆ, å›å¿†ä¸‹åˆšè¯æ˜çš„...

$$
`\begin{align}
  \mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}} \mid {X}_{i},\, \color{#e64173}{s_i = 12} \right] -  \mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}} \mid {X}_{i},\, \color{#e64173}{s_i = 11} \right] = \mathop{E}\left[ f_i(\color{#e64173}{12}) - f_i(\color{#e64173}{11}) \mid {X}_{i} \right]
\end{align}`
$$

ç°åœ¨å–ä¸¤è¾¹çš„æœŸæœ›å€¼å¹¶åº”ç”¨è¿­ä»£æœŸæœ›æ³•åˆ™(LIE)

.big-left[
`\(E_X\!\bigg(\mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}} \mid {X}_{i},\, \color{#e64173}{s_i = 12} \right] -  \mathop{E}\left[ \color{#6A5ACD}{{Y}_{i}} \mid {X}_{i},\, \color{#e64173}{s_i = 11} \right] \bigg)\)`
]
.big-left[
`\(=E_X\! \bigg( \mathop{E}\left[ f_i(\color{#e64173}{12}) - f_i(\color{#e64173}{11}) \mid {X}_{i}\right] \bigg)\)`
]
.big-left[
`\(=\mathop{E}\left[ f_i(\color{#e64173}{12}) - f_i(\color{#e64173}{11}) \right]\)`â€ƒ.grey-light[(è¿­ä»£æœŸæœ›)]
]
---

### LPF + CIA .mono[-&gt;] å› æœæ•ˆåº”

ç°åœ¨æˆ‘ä»¬å°†LPFä¸éšæœºå®éªŒçš„ç ”ç©¶è®¾è®¡æ•´åˆåœ¨ä¸€èµ·ã€‚å‡è®¾æˆ‘ä»¬èƒ½å¤Ÿæ ¹æ®ç†è®ºæç‚¼å‡ºï¼Œæ€»ä½“çš„ã€çº¿æ€§çš„ã€**åŒè´¨å› æœæ•ˆåº”**æ¨¡å‹ï¼š

$$
`\begin{align}
  f_i(\color{#e64173}{s}) = \alpha + \tau \color{#e64173}{s} + \eta_i \tag{A}
\end{align}`
$$

- æ€»ä½“æ¨¡å‹æ˜¯å› ä¸º `\((\text{A})\)` å¼å‘Šè¯‰æˆ‘ä»¬çš„æ˜¯ä¸ªä½“ `\(i\)` åœ¨ `\(\color{#e64173}{s}\)` çš„ä»»æ„å€¼ä¸‹èƒ½å¤Ÿèµšå¾—çš„æ”¶å…¥(è¿™é‡Œæ˜¯æ½œåœ¨æ”¶å…¥)ï¼Œ è€Œä¸æ˜¯ä¾æ® `\(\color{#e64173}{s_i}\)` è§‚æµ‹å€¼ï¼Œæ‰€ä»¥çœç•¥äº† `\(\color{#e64173}{s}\)` çš„ä¸‹æ ‡ `\(i\)` ã€‚
- è¯¥å¼å‡è®¾åœ¨ `\(f_i(\color{#e64173}{s})\)` ä¸­å”¯ä¸€å› äººè€Œå¼‚çš„éƒ¨åˆ†æ˜¯å¹²æ‰°é¡¹ `\(\eta_{i}\)` , å…¶å‡å€¼ä¸º 0 , ç”¨ä»¥æ•æ‰å†³å®šæ½œåœ¨æ”¶å…¥æ°´å¹³ `\(f_i(\color{#e64173}{s})\)` çš„å…¶ä»–ä¸å¯è§‚æµ‹å› ç´ ã€‚å°†è§‚å¯Ÿåˆ°çš„ `\(\color{#e64173}{s_i}\)` å’Œè§‚å¯Ÿå€¼ `\(\color{#6A5ACD}{{Y}_{i}}\)`  ä»£å…¥æ¨¡å‹ï¼Œå°±å¾—åˆ°äº†**æ ·æœ¬å›å½’æ¨¡å‹**:

$$
`\begin{align}
  \color{#6A5ACD}{{Y}_{i}} = \alpha + \tau \color{#e64173}{s_i} + \eta_i \tag{B}
\end{align}`
$$
- å…¶ä¸­ `\((\text{A})\)` å¼ä¸­ `\(\tau\)` æ˜¯**çœŸå®çš„å¤„ç½®æ•ˆåº”**ï¼Œè€Œ `\((\text{B})\)` å¼ä¸­ `\(\tau\)` 
é€šå¸¸ç”±äº `\(s_i\)` å­˜åœ¨çš„å†…ç”Ÿæ€§é—®é¢˜(é—æ¼å˜é‡ã€æµ‹é‡åè¯¯å’Œåå‘å› æœ)ä¸æ˜¯çœŸå®çš„å¤„ç½®æ•ˆåº”ã€‚åœ¨æ–‡ç« çš„**ç ”ç©¶è®¾è®¡**éƒ¨åˆ†è¦è¯´æ˜å¦‚ä½•æ‰èƒ½å¾—åˆ°çœŸå®çš„å¤„ç½®æ•ˆåº”ã€‚

---
### LPF + CIA .mono[-&gt;] å› æœæ•ˆåº”

ç°åœ¨å°±å¯ä»¥åŠ å…¥å¤šä¸ª**å¯è§‚å¯Ÿ**çš„åå˜é‡ `\(X_{i}\)` ï¼Œ å®ƒä»¬CIAæˆç«‹ï¼Œæ„å›¾æ’é™¤**å¹²æ‰°å› ç´ **ã€‚æˆ‘ä»¬å°†æ½œåœ¨æ”¶å…¥æ°´å¹³ `\(f_i(\color{#e64173}{s})\)` çš„éšæœºé¡¹è¡¨è¾¾ä¸ºå¯è§‚å¯Ÿå˜é‡ `\(X_{i}\)` (å› äººè€Œå¼‚)å’Œ**æ®‹å·®é¡¹** `\(v_{i}\)` çš„çº¿æ€§å‡½æ•°ï¼š

$$
`\begin{align}
  \eta_i = {X}_{i}'\beta + \nu_i \tag{C}
\end{align}`
$$

å…¶ä¸­ `\(\beta\)` æ˜¯ `\(\eta_i\)` å¯¹ `\({X}_{i}\)` å›å½’çš„æ€»ä½“ç³»æ•°å‘é‡(æ„å‘³ç€ä¸Šå¼å‡è®¾æ˜¯å¯ä»¥é€šè¿‡æœ€å°äºŒä¹˜ä¼°è®¡è·å¾—æ­£ç¡®çš„ç³»æ•°ä¼°è®¡)ï¼Œæ‰€ä»¥æœ‰ï¼š

1.  `\(\mathop{E}\left[ \eta_i \mid {X}_{i} \right] = {X}_{i}'\beta\)` 
1. æ®‹å·®é¡¹ `\(v_{i}\)` ä¸ `\(X_{i}\)` ä¸ç›¸å…³

---
### LPF + CIA .mono[-&gt;] å› æœæ•ˆåº”

è¿›ä¸€æ­¥ï¼Œç”±CIAæˆ‘ä»¬å¯ä»¥ï¼š

.big-left[
`\(\mathop{E}\left[ f_i(\color{#e64173}{s}) \mid {X}_{i},\, \color{#e64173}{s_i} \right]\)`
]
.big-left[
`\(=\mathop{E}\left[ f_i(\color{#e64173}{s}) \mid {X}_{i} \right]\)`â€ƒ.grey-light[(æ ¹æ®CIA)]
]
.big-left[
`\(=\mathop{E}\left[ \alpha + \tau \color{#e64173}{s_i} + \eta_i \mid {X}_{i} \right]\)`â€ƒ.grey-light[(ä»£å…¥Bå¼)]
]
.big-left[
`\(=\alpha + \tau \color{#e64173}{s_i} + \mathop{E}\left[ \eta_i \mid {X}_{i} \right]\)`
]
.big-left[
`\(=\alpha + \tau \color{#e64173}{s_i} + {X}_{i}'\beta\)`â€ƒ.grey-light[(æœ€å°äºŒä¹˜å›å½’æ–¹ç¨‹)]
]

.hi-pink[å›å¿†] è¿™é‡Œå†æ¬¡ä½¿ç”¨åˆ°ï¼Œè‹¥ `\(f_i(\color{#e64173}{s})\)` çš„CEFæ˜¯çº¿æ€§çš„(å¦‚å€’æ•°ç¬¬2è¡Œ)ï¼Œåˆ™æ„å‘³ç€"æ­£ç¡®.super[.pink[â€ ]]" LPFå°±æ˜¯CEFã€‚


.footnote[
.pink[â€ ] è¿™é‡Œ"æ­£ç¡®"æ˜¯æŒ‡è‹¥æ§åˆ¶äº† `\({X}_{i}\)` å°±åƒRCTä¸€æ ·ã€‚
]

---
### LPF + CIA .mono[-&gt;] å› æœæ•ˆåº”

æ‰€ä»¥æˆ‘å¯ä»¥æŠŠæ¨¡å‹è®¾ç½®å¦‚ä¸‹ï¼š 
$$
`\begin{align}
  {Y}_{i} = \alpha + \tau \color{#e64173}{s_i} + {X}_{i}'\beta + \nu_i
\end{align}`
$$

é€šè¿‡é™åˆ¶æ‰°åŠ¨é¡¹ `\(\nu_i\)` çš„æ€§è´¨:
1. `\(\color{#e64173}{s_i}\)` (æ ¹æ® CIA)
2. `\({X}_{i}\)` (æ ¹æ®å®šä¹‰ `\(\beta\)` æ˜¯ `\(\eta\)` å¯¹ `\({X}_{i}\)` å›å½’çš„æ€»ä½“ç³»æ•°å‘é‡)

 å°±æ˜¯
æ¥å¾—åˆ°æˆ‘ä»¬æœ€æ„Ÿå…´è¶£çš„å› æœæ•ˆåº” `\(\tau\)`

---
### LPF.super[ols] ä¸ "æœ´ç´ "ä¼°è®¡é‡çš„å…³ç³»

.hi-pink[å›å¿†ï¼š"æœ´ç´ "ä¼°è®¡é‡æ˜¯å¹²é¢„ç»„ä¸æ§åˆ¶ç»„çš„è§‚æµ‹ç»“æœå‡å€¼ä¹‹å·®] `\(E[Y_{i}|D_{i}=1]-E[Y_{i}|D_{i}=0]\)`

å½“å¹²é¢„å˜é‡ä¸ºäºŒå€¼æ—¶ï¼Œå¯ä»¥è¯æ˜å›å½’ç³»æ•° `\(\hat\tau_{{OLS}}\)` ç­‰äºå¤„ç†ç»„ä¸æ§åˆ¶ç»„æ ·æœ¬å‡å€¼ä¹‹å·®(by Mixtape)ã€‚åœ¨æ ·æœ¬è§†è§’ä¸‹ï¼š
`$$\hat\tau_{{OLS}} = \frac{1}{N_{T}} \sum_{i=1}^{n}\left(y_{i} \mid d_{i}=1\right)-\frac{1}{N_{C}} \sum_{i=1}^{n}\left(y_{i} \mid d_{i}=0\right) = \bar{Y}_{T}-\bar{Y}_{C}$$`
åœ¨å¤§æ ·æœ¬ä¸‹:
`$$\hat\tau_{{OLS}} = \bar{Y}_{T}-\bar{Y}_{C} \stackrel{p}{\longrightarrow} E\left[Y_{i} \mid D_{i}=1\right]-E\left[Y_{i} \mid D_{i}=0\right]=\tau_{{OLS}}$$`
ç»¼ä¸Š, `\(\hat\tau_{{OLS}} = \bar{Y}_{T}-\bar{Y}_{C} \stackrel{p}{\longrightarrow}\tau_{{OLS}} = â€œæœ´ç´ â€ä¼°è®¡é‡\)`  

"æœ´ç´ "ä¼°è®¡é‡ .mono[=] ATE + é€‰æ‹©åè¯¯ +å¼‚è´¨æ€§å¹²é¢„åè¯¯ (by Mixtape) , åŸºäºSUTVAç¬¬ä¸‰é¡¹ä¸ºé›¶

---
### LPF.super[ols]+æ§åˆ¶å˜é‡+å‡è®¾ .mono[-&gt;] å› æœæ•ˆåº”

ç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“åœ¨ï¼š
`\({E}\left[Y_{i}(0) \mid D_{i}=1\right] \neq {E}\left[Y_{i}(0) \mid D_{i}=0\right]\)` æ—¶, æ— æ³•è¯†åˆ«å¤„ç½®æ•ˆåº”ã€‚

å‡å¦‚é€ æˆå·®å¼‚çš„åŸå› : ä¸ªä½“æœªå¹²é¢„æ—¶çš„æ½œåœ¨ç»“æœ `\(Y_i(0)\)`  æ˜¯å¯è§‚æµ‹ç‰¹å¾å’Œä¸å¯è§‚æµ‹ç‰¹å¾çš„çº¿æ€§å‡½æ•°
`$$Y_{i}(0)=\alpha+\beta X_{i}+e_{i}$$` 
ä»£å…¥æ–¹ç¨‹:  `\({Y}_{{i}}=\underbrace{{E}\left[{Y}_{{i}}(0)\right]}_{a}+\underbrace{\left[Y_{i}(1)-Y_{i}(0)\right] \times {D}_{i}}_{\tau}+\underbrace{Y_{i}(0)-{E}\left[Y_{i}(0)\right]}_{u_{i}}\)`

å¾—: `\(Y_{i}=\alpha+\tau D_{i}+\beta X_{i}+e_{i}\)`  ï¼ˆè§‚æµ‹ç»“æœã€å¹²é¢„çŠ¶æ€ã€å¯è§‚æµ‹ç‰¹å¾ã€ä¸å¯è§‚æµ‹ç‰¹å¾çš„å…³ç³»ï¼‰

å°† `\(Y_{i}\)` å¯¹ `\(D_{i} ã€ X_{i}\)` å½’å›: `\({E}\left({Y}_{{i}} \mid {D}_{{i}}, {X}_{{i}}\right)=\alpha+\ D_{i}+\beta X_{i}+{E}\left[e_{i} \mid {D}_{{i}}, {X}_{{i}}\right]\)`

---
### LPF.super[ols]+æ§åˆ¶å˜é‡+å‡è®¾ .mono[-&gt;] å› æœæ•ˆåº”

- ä¸CIAæ€è·¯ä¸€æ ·ï¼Œè‹¥è¦ä½¿å¾—æ¡ä»¶æœŸæœ›å‡½æ•°çš„ `\(D_i\)` çš„ç³»æ•°ç­‰äº `\(\tau\)` ,éœ€è¦ ä»¥è§‚æµ‹ç»“æœã€å¹²é¢„çŠ¶æ€ã€å¯è§‚æµ‹ç‰¹å¾ä¸ºåŸºç¡€çš„LPFçš„å¹²æ‰°é¡¹ `\(e_i\)` çš„æ¡ä»¶å‡å€¼ç‹¬ç«‹äºå¹²é¢„å˜é‡ï¼š

  `\(E[e_i \mid D_i,X_i] = E[e_i \mid X_i]\)` 

- å¯è¯æ˜ï¼š**(å»ºç«‹åœ¨LPF.super[ols]åŸºç¡€ä¸Šçš„)å¹²æ‰°é¡¹æ¡ä»¶å‡å€¼ç‹¬ç«‹äºå¹²é¢„å˜é‡**å’Œ **å¹³å‡æœªå¹²é¢„æ½œåœ¨ç»“æœæ¡ä»¶ç‹¬ç«‹**ï¼ˆ `\(E\left[Y_{i}(0) \mid D_{i}=1\right] = E\left[Y_{i}(0) \mid D_{i}=0\right]\)`  ï¼‰æ˜¯ç­‰ä»·çš„

- è¿™ä¸ªæ¡ä»¶ä½¿å¾—LPF.super[ols]å¯ä»¥é€šè¿‡åŠ å…¥æ§åˆ¶å˜é‡X æ¥è¾¾åˆ°ä¼°è®¡å¤„ç½®å˜é‡D çš„çœŸå®å› æœæ•ˆåº”ç³»æ•° `\(\tau\)` çš„ç›®çš„

- **CMI** ä¸ **CIA** æ˜¯ç›´æ¥å»ºç«‹åœ¨ **æ½œåœ¨ç»“æœ**ä¸Šçš„ï¼›**å¹²æ‰°é¡¹æ¡ä»¶å‡å€¼ç‹¬ç«‹äºå¹²é¢„å˜é‡** å’Œ **å¹³å‡æ½œåœ¨ç»“æœæ¡ä»¶ç‹¬ç«‹** æ˜¯å»ºç«‹åœ¨**å¹³å‡æ½œåœ¨ç»“æœ**åŸºç¡€ä¸Šï¼ˆæ˜¯åœ¨CEF-LPF æ¡†æ¶ä¸‹èƒ½å¤Ÿè¯†åˆ«å¤„ç½®æ•ˆåº”çš„å…³é”®æ¡ä»¶ï¼‰

---
class: title-slide-section,inverse,center,middle
# æ¡ä»¶æœŸæœ›çš„æ€§è´¨ï¼ˆè‡ªå­¦ï¼‰

---
### æ¡ä»¶æœŸæœ›å€¼å‡½æ•°çš„æ€§è´¨

- **æ€§è´¨1** (æœŸæœ›è¿­ä»£æ³•åˆ™,law of iterated expectation)
$$
E[E[Y \mid X]]=E[Y]
$$

 `\(E[Y|X]\)` çš„æœŸæœ›å€¼æ˜¯ `\([Y]\)` çš„æ— æ¡ä»¶æœŸæœ›å€¼ã€‚
 &lt;br/&gt;&lt;br/&gt;
ä¾‹å¦‚ï¼š
![Fx16GT](https://pkuzzq-image.oss-cn-beijing.aliyuncs.com/uPic/Fx16GT.png)
---
- **æ€§è´¨1**æ¨è®º
`$$E\left[E[Y|X_{1},X_{2}]|X_{1}\right]=E[Y|X_{1}]$$`
    - å†…éƒ¨æœŸæœ›å€¼ä»¥X1å’ŒX2åŒæ—¶ä¸ºæ¡ä»¶,å¤–éƒ¨æœŸæœ›å€¼åªä»¥X1ä¸ºæ¡ä»¶ã€‚è¿­ä»£åçš„æœŸæœ›å€¼å¯ä»¥å¾—åˆ°ç®€å•çš„ç­”æ¡ˆE[Y|X1],å³åªä»¥X1ä¸ºæ¡ä»¶çš„æœŸæœ›å€¼ã€‚ã€ŠEã€‹è¡¨è¿°ä¸º"è¾ƒå°çš„ä¿¡æ¯é›†è·èƒœ" â†’ ä»¥å°è°‹å¤§
&lt;br/&gt;&lt;br/&gt;
ä¾‹ï¼š
![Q65T2b](https://pkuzzq-image.oss-cn-beijing.aliyuncs.com/uPic/Q65T2b.png)

---
- **æ€§è´¨2** (çº¿æ€§) `$$E[a(X)Y+b(X)|X]=a(X)E[Y|X]+b(X)$$` å¯¹äºå‡½æ•° `\(a(\cdot)\)` and `\(b(\cdot)\)`. 
 &lt;br/&gt;&lt;br/&gt;
 &lt;br/&gt;&lt;br/&gt;

- **æ€§è´¨3**ï¼ˆç‹¬ç«‹æ„å‘³ç€å‡å€¼ç‹¬ç«‹ï¼‰
 &lt;br/&gt;&lt;br/&gt;
è‹¥ `\(X\)` ä¸ `\(Y\)` ç‹¬ç«‹, åˆ™ `\(E[Y|X]=E[Y]\)`

---
- **æ€§è´¨3**çš„è¯æ˜ (ä»¥ç¦»æ•£å˜é‡ä¸ºä¾‹): 
$$
`\begin{eqnarray}
E[Y|X]&amp;=&amp;\sum_{i=1}^{N}y_{i}P(Y=y_{i}|X) \\
	  &amp;=&amp;\sum_{i=1}^{N}y_{i}\frac{P(Y=y_{i},X)}{P(X)} \\
	  &amp;=&amp;\sum_{i=1}^{N}y_{i}\frac{P(Y=y_{i})\times P(X)}{P(X)} 
	  &amp;=&amp;E[Y].
\end{eqnarray}`
$$
ç”¨åˆ°äº† `\(P(Y=y,X=x)=P(X=x)P(Y=y)\)` .

---
    
- **æ€§è´¨4** ï¼ˆå‡å€¼ç‹¬ç«‹æ„å‘³ç€ä¸ç›¸å¹²ï¼‰
&lt;br/&gt;
è‹¥ `\(E[Y|X]=E[Y]\)`, åˆ™ `\(Cov(X,Y)=0\)`.
    -  `\(E[Y|X]=E[Y]\)` is å‡å€¼ç‹¬ç«‹(**mean independence**)
    - è®°ä½: å‡å€¼ç‹¬ç«‹æ„å‘³ç€ä¸ç›¸å¹²ï¼Œåè¿‡æ¥ä¸ä¸€å®šæˆç«‹.

- **æ€§è´¨5** ï¼ˆæ¡ä»¶æœŸæœ›å€¼æ˜¯æœ€å°å‡å€¼å¹³æ–¹è¯¯å·®ï¼‰
&lt;br/&gt;
å‡è®¾å¯¹äºä»»æ„å‡½æ•° `\(g\)` æœ‰ `\(E[Y^{2}]&lt;\infty\)` å¹¶ `\(E[g(X)]&lt;\infty\)` , é‚£ä¹ˆ `$$E[(Y-\mu(X))^{2}]\leq E[(Y-g(X))^{2}]$$` 
å…¶ä¸­ `\(\mu(X)=E[Y|X]\)`
&lt;br/&gt;
è§£è¯»:
    - å‡è®¾ä½¿ç”¨æŸç§å‡½æ•°å½¢å¼ `\(g\)` å’Œæ•°æ® `\(X\)` æ¥è§£é‡Š `\(Y\)`
    -  é‚£ä¹ˆ `\(g\)` çš„æœ€å°å‡æ–¹è¯¯ï¼ˆ **the mean squared error** ï¼‰å°±æ˜¯æ¡ä»¶æœŸæœ›ã€‚


---

- **æ€§è´¨5**çš„è¯æ˜:
$$
`\begin{eqnarray}
E[(Y-g(X))^{2}]	&amp;=&amp;E[\left\{ \left(Y-\mu(X)\right)+\left(\mu(X)-g(X)\right)\right\} ^{2}]\\
	&amp;=&amp;E\left[\left(Y-\mu(X)\right)^{2}\right]+E\left[\left(\mu(X)-g(X)\right)^{2}\right]\\
	&amp;+&amp; 2E\left[\left(Y-\mu(X)\right)\left(\mu(X)-g(X)\right)\right].
\end{eqnarray}`
$$
ä½¿ç”¨æœŸæœ›è¿­ä»£æ³•åˆ™
$$
`\begin{eqnarray}
E\left[\left(Y-\mu(X)\right)\left(\mu(X)-g(X)\right)\right]	&amp;=&amp;E\left\{E\left[\left(Y-\mu(X)\right)\left(\mu(X)-g(X)\right)|X\right]\right\} \\
	&amp;=&amp;E\left\{ \left(\mu(X)-g(X)\right)\left(E[Y|X]-\mu(X)\right)\right\} \\
	&amp;=&amp;0
\end{eqnarray}`
$$
æ‰€ä»¥ï¼Œ
$$
E[(Y-g(X))^{2}]=E\left[\left(Y-\mu(X)\right)^{2}\right]+E\left[\left(\mu(X)-g(X)\right)^{2}\right]
$$ 
ä¸Šå¼å–æœ€å°å€¼ï¼Œå½“ä¸”ä»…å½“ `\(g(X)=\mu(X)\)`.



---

- **æ¦‚ç‡è¿­ä»£æ³•åˆ™**
`$$P(Y)=\sum_{i=1}^{N}P(Y|x_{i})P(x_{i})$$`   
`\(X\)`æ˜¯ç¦»æ•£éšæœºå˜é‡
&lt;br/&gt;&lt;br/&gt;
- **æ–¹å·®åŠ æ³•æ³•åˆ™**
`$$Var(Y)=E[V(Y|X)]+V[E(Y|X)]$$`

---

class: title-slide-section,inverse, middle
# SUTVA

---

åœ¨ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œéƒ½æ˜¯å‡è®¾ä¸ªä½“å¤„ç½®æ•ˆåº”æ˜¯ç›¸åŒçš„ï¼Œå³ `\(\tau_i= \tau\)`ã€‚è¿™é‡Œæ­£å¼æå‡º **SUTVA** å‡è®¾ã€‚

- **ç¨³å®šä¸ªä½“å¹²é¢„å€¼å‡è®¾ï¼ˆThe Stable Unit Treatment Value Assumptionï¼Œ SUTVAï¼‰**:ç®€å•è¯´ï¼Œæ¯ä¸ªä¸ªä½“çš„æ½œåœ¨ç»“æœä¸ä¾èµ–äºå…¶ä»–ä¸ªä½“çš„å¹²é¢„çŠ¶æ€ã€‚æœ‰ä¸¤å±‚å«ä¹‰ï¼š1. ä¸åŒä¸ªä½“çš„æ½œåœ¨ç»“æœä¹‹é—´ä¸ä¼šæœ‰äº¤äº’å½±å“ã€‚2. å¹²é¢„æ°´å¹³å¯¹æ‰€æœ‰ä¸ªä½“éƒ½æ˜¯ç›¸åŒçš„ã€‚

- ç¬¬1ä¸ªå«ä¹‰ï¼šå®ƒæ’é™¤äº†**å¤–éƒ¨æ€§**æˆ–**å‡è¡¡æ•ˆåº”**ã€‚

    - ä¾‹ï¼šç ”ç©¶ç­çº§è§„æ¨¡å¯¹ä¸ªä½“å­¦ä¹ æ•ˆæœçš„å½±å“ï¼ŒåŒå­¦ä¹‹é—´å¾€å¾€å­˜åœ¨å¤–éƒ¨æ€§ï¼Œå¦‚æœç­çº§é‡Œå¥½å­¦ç”Ÿå¤šï¼Œç›¸äº’è®¨è®ºã€ç›¸äº’ä¿ƒè¿›ï¼Œäº§ç”Ÿæ­£å¤–éƒ¨æ€§ï¼Œä»è€Œæé«˜äº†æ•´ä½“å­¦ä¹ æ•ˆç‡ã€‚
    - ä¾‹ï¼šå¦‚æœåŠ³åŠ¨åŠ›åŸ¹è®­é¡¹ç›®è§„æ¨¡å¾ˆå¤§ï¼Œæ”¹å˜æ•´æ”¹å¸‚åœºæŠ€èƒ½ç»“æ„ï¼Œä½¿å¾—æŠ€èƒ½åŠ³åŠ¨åŠ›ä¾›ç»™å¾ˆå¤šï¼Œåˆ™æ¥å—åŸ¹è®­çš„ä¸ªä½“å¹²é¢„æ•ˆæœå°±ä¸æ˜¾è‘—ã€‚

---

- ç¬¬2å±‚å«ä¹‰ï¼šå¤„ç½®æ•ˆåº”å¯¹æ‰€æœ‰ä¸ªä½“ç›¸åŒã€‚

    - ä¾‹å¦‚ï¼šæ•™è‚²å¯¹ä¸ªäººæ”¶å…¥å½±å“ã€‚è¦æ±‚çº³å…¥çš„æ•™è‚²ç¨‹åº¦è¦æ±‚æ•™è‚²è´¨é‡ç›¸åŒ.

- ç¤¾ä¼šç§‘å­¦ï¼Œå®é™…ä¸­å¯¹ç¬¬1é¡¹æ›´ä¸ºå…³æ³¨.

---

class: title-slide-section,inverse, middle
# åè¯¯ç±»å‹ä¸è§£å†³åŠæ³•

---
### æœ‰å‘æ— ç¯å›¾è¡¨è¾¾åè¯¯ç±»å‹
  
  - å› æœè·¯å¾„
  - æ··æ·†è·¯å¾„: A .mono[&lt;-] B .mono[-&gt;] C , Bæ˜¯Aå’ŒCçš„æ··æ·†å˜é‡; æ··æ·†å˜é‡ä¼šå¯¼è‡´ç›¸å…³å…³ç³»
  - å¯¹æ’è·¯å¾„: A .mono[-&gt;] B .mono[&lt;-] C , Bæ˜¯Aå’ŒCçš„å¯¹æ’å˜é‡; å¯¹æ’å˜é‡ä¸ä¼šäº§ç”Ÿç›¸å…³æ€§

- ä¼°è®¡Xä¸Yçš„å› æœå…³ç³»çš„æœ¬è´¨æ˜¯æ‰¾åˆ°äºŒè€…é—´æ‰€æœ‰çš„å› æœè·¯å¾„ï¼ŒåŒæ—¶å» é™¤äºŒè€…é—´çš„éå› æœå…³ç³»è·¯å¾„ã€‚

---
### æ··æ·†åè¯¯ï¼ˆå¥½çš„æ§åˆ¶ï¼‰

- æ··æ·†åè¯¯æ˜¯æŒ‡åœ¨Xå’ŒYä¹‹é—´å­˜åœ¨æœªæˆªæ–­çš„æ··æ·†è·¯å¾„ï¼Œé€ æˆXå’ŒYçš„ç›¸å…³æ€§ä¸ä»…åŒ…å«å› æœå…³ç³»ï¼Œè¿˜åŒ…å«éå› æœå…³ç³»ã€‚

- æˆªæ–­æ··æ·†è·¯å¾„æ˜¯é€šè¿‡ç»™å®šæ··æ·†å˜é‡ï¼ˆconditional on confounding variableï¼‰ä¸ºæ¡ä»¶ï¼Œä»è€Œæ’é™¤æ··æ·†å˜é‡çš„å¹²æ‰°ã€‚ç»™å®šæ··æ·†å˜é‡å¯ä»¥ç®€å•çš„ç†è§£ä¸ºå›ºå®šæ··æ·†å˜é‡çš„å€¼ã€‚åœ¨å…³ç³»å›¾ä¸­ï¼Œæˆ‘ä»¬åŠ ä¸ªæ–¹æ¡†è¡¨ç¤ºè¿™ä¸ªå˜é‡æ˜¯ç»™å®šçš„ã€‚

- å½“æ··æ·†å˜é‡ç»™å®šæ—¶ï¼ŒXå’ŒYçš„ç›¸å…³æ€§å°±ä¸æ··æ·†å˜é‡æ— å…³ï¼ŒäºŒè€…ç›¸å…³æ€§å°±æ˜¯å› æœå…³ç³»ã€‚

.center[
![H1mMrc](https://pkuzzq-image.oss-cn-beijing.aliyuncs.com/uPic/H1mMrc.png)
]

---
## è¿‡åº¦æ§åˆ¶åè¯¯

- è¿‡åº¦æ§åˆ¶åè¯¯æ˜¯æŒ‡æ§åˆ¶äº†å› æœè·¯å¾„ä¸Šçš„å˜é‡é€ æˆçš„åè¯¯

- åœ¨ç ”ç©¶ä¸­æˆ‘ä»¬è¦é¿å…æ§åˆ¶å—Xå½±å“å¹¶ä¼šå½±å“Yçš„ä¸­ä»‹å˜é‡ï¼Œå¦åˆ™ä¼šé€ æˆè¿‡åº¦æ§åˆ¶åå·®ã€‚
&lt;br&gt;&lt;br&gt;&lt;br&gt;
.center[
![gVegRq](https://pkuzzq-image.oss-cn-beijing.aliyuncs.com/uPic/gVegRq.png)
.center[.cap[å›¾ï¼šè¿‡åº¦æ§åˆ¶åå·®]]
]

- æ§åˆ¶äº†ç”Ÿæ´»è§„å¾‹ï¼Œå°±æˆªæ–­äº†ä¸€æ¡å› æœè·¯å¾„ï¼Œä¼°è®¡å¾—åˆ°çš„åªæ˜¯é”»ç‚¼å¯¹å¥åº·çš„ç›´æ¥å› æœå…³ç³»ï¼Œç›¸å½“äºä½ä¼°çœŸå®å€¼
---
### å¯¹æ’åè¯¯

- å¯¹æ’åè¯¯å¯ä»¥ç†è§£ä¸ºå½“ç»™å®šä¸¤ä¸ªå˜é‡çš„å…±åŒç»“æœï¼ˆå¯¹æ’å˜é‡ï¼‰ æ—¶ï¼ˆæˆ–è€…å¯¹æ’å˜é‡çš„å»¶ä¼¸å› å˜é‡ï¼‰ï¼Œä¸¤ä¸ªå˜é‡é—´ä¼šäº§ç”Ÿä¸€ä¸ªè¡ç”Ÿè·¯å¾„ã€‚ è¡ç”Ÿè·¯å¾„ä¼šé€ æˆä¸¤ä¸ªåŸæœ¬ä¸ç›¸å…³çš„å˜é‡å˜ä¸ºç›¸å…³ï¼Œæˆ–é€ æˆä¸¤ä¸ªåŸæœ¬ç›¸å…³ çš„å˜é‡çš„ç›¸å…³æ€§å‘ç”Ÿæ”¹å˜ã€‚
&lt;br&gt;&lt;br&gt;&lt;br&gt;
.center[
![Uldp6M](https://pkuzzq-image.oss-cn-beijing.aliyuncs.com/uPic/Uldp6M.png).center[.cap[å›¾ï¼šå¯¹æ’åè¯¯]]
]
---
### å¯¹æ’åè¯¯

.center[
&lt;img src="https://pkuzzq-image.oss-cn-beijing.aliyuncs.com/uPic/0lB77J.png" height="200"&gt;
]
.center[
&lt;img src="https://pkuzzq-image.oss-cn-beijing.aliyuncs.com/uPic/tCw3Dn.png" height="200"&gt;
]

---
### è§£å†³åŠæ³•

- æ–‡çŒ®å¯»æ‰¾åè¯¯æ½œåœ¨æ¥æº .mono[&lt;=&gt;] å»ºç«‹æœ‰å‘æ— ç¯å›¾ .mono[&lt;=&gt;] å¯»æ‰¾å¯¹åº”è§£å†³åŠæ³• .mono[&lt;=&gt;] æ·±æŒ–**æ•°æ®ç”Ÿæˆè¿‡ç¨‹**

.pull-left[
- .hi-pink[å›å¿†ï¼š] æ•™è‚²ç¨‹åº¦å¯¹æ”¶å…¥

- å‡è®¾æœ€åˆåªæ˜¯é€šè¿‡å»ºç«‹å¦‚ä¸‹LPF.super[0]æ¥ä¼°è®¡å¤„ç½®æ•ˆåº”
`$$I N C_{i t}=\alpha+\beta_{1} E D U_{i t}+\varepsilon_{i t}$$`

- å½“å¯è§‚æµ‹å˜é‡ï¼ˆæ€§åˆ«ã€å¹´é¾„ï¼‰å’Œä¸å¯è§‚æµ‹å˜é‡ï¼ŒåŒæ—¶è¿›å…¥æ‰°åŠ¨é¡¹ `\(\varepsilon_{i t}\)` ï¼Œå¯¼è‡´ `\(\varepsilon_{i t}\)` , æ‰€ä»¥æ— æ³•è¯†åˆ«å› æœå½±å“ç³»æ•° `\(\beta\)` ã€‚
`$$\varepsilon_{i t}=\beta_{2} A G E_{i t}+\beta_{3} G E N D E R_{i}+e_{i t}$$`
]

.pull-right[
.center[![AxVxif](https://pkuzzq-image.oss-cn-beijing.aliyuncs.com/uPic/AxVxif.png)]
.center[.cap[å›¾ï¼šLPFç­‰ä»·äºåœ¨DACä¸­å¿½ç•¥äº†å¹´é¾„å’Œæ€§åˆ«]]
]

---
### ä¾‹å­ï¼šè§£å†³åŠæ³•

- å¯ä»¥å°† `\(\varepsilon_{i t}\)` ä¸­çš„å¯è§‚æµ‹å˜é‡åˆ†ç¦»è¿›è¡Œæ§åˆ¶ï¼Œå¾—åˆ° LPF.super[1]

 `\(I N C_{i t}=\alpha+\beta_{1} E D U_{i t}+\beta_{2} A G E_{i t}+\beta_{3} G E N D E R_{i}+e_{i t}\)` ï¼Œå…¶ä¸­ `\(e_{i t}\)` ä¸ºä¸å¯è§‚æµ‹å˜é‡ï¼Œå¦‚ï¼ˆä¸ªæ€§ã€ç«äº‰æ„è¯†ï¼‰.

- `\(A G E_{i t}\)` å’Œ `\(E D U_{i t}\)` ä¸ºæ—¶å˜å˜é‡ï¼› `\(G E N D E R_{i}\)` ä¸ºéæ—¶å˜å˜é‡ï¼ˆè™šæ‹Ÿå˜é‡ã€ç±»åˆ«å˜é‡ï¼‰

.center[
![DlOEnk](https://pkuzzq-image.oss-cn-beijing.aliyuncs.com/uPic/DlOEnk.png)
]
---
### ä¾‹å­ï¼šè§£å†³åŠæ³•

- å€˜è‹¥çœŸå®å…³ç³»æ˜¯å³å›¾ï¼Œä»æ— æ³•è¯†åˆ«å› æœå…³ç³»
- å°† `\(\varepsilon_{i t}\)` è¿›ä¸€æ­¥åˆ†è§£ä¸ºï¼šä¸å¯è§‚æµ‹çš„éæ—¶å˜å˜é‡ `\(\alpha_i\)` å’Œä¸å¯è§‚æµ‹çš„æ—¶å˜å˜é‡ `\(u_{it}\)` ï¼Œå³ `\(e_{it}=\alpha_i+u_{it}\)`
`$$I N C_{i t}=\alpha+\beta_{1} E D U_{i t}+\beta_{2} A G E_{i t}+\beta_{3} G E N D E R_{i}+\alpha_{i}+u_{i t}$$`

- å¦‚æœæ··æ·†è·¯å¾„æ˜¯ `\(\alpha_i\)` é€ æˆçš„ï¼Œæˆ‘ä»¬å¸Œæœ›æ§åˆ¶ `\(\alpha_i\)` æˆªæ–­æ··æ·†è·¯å¾„ã€‚å³é‡‡ç”¨é¢æ¿æ•°æ®åˆ†ææ³•å¯ä»¥è¾¾åˆ°æ§åˆ¶ä¸å¯è§‚æµ‹çš„éæ—¶å˜å˜é‡ã€‚

.center[
&lt;img src="https://pkuzzq-image.oss-cn-beijing.aliyuncs.com/uPic/IGD9bh.png" height="200"&gt;
]

---
### ä¾‹å­ï¼šè§£å†³åŠæ³•

- å®é™…ä¸Šï¼Œå¤§éƒ¨åˆ†ç¤¾ä¼šç ”ç©¶ä¸å¤ªèƒ½è½»æ˜“åœ°åœ¨ `\(\varepsilon_{i t}\)` ä¸­åˆ†ç¦»å‡ºä¸å¯è§‚æµ‹å’Œå¯è§‚æµ‹å˜é‡
- å¼•å…¥å…¥å…·å˜é‡ `\(Z_{i}\)` åˆ†è§£å‡º `\(E D U_{i t}\)` å˜åŒ–ä¸­ä¸ `\(e_{i t}\)` æ— å…³çš„éƒ¨åˆ†, å³ `\(E D U_{i t}=\)` `\(\widehat{E D U_{i t}}+v_{i t}\)`, å…¶ä¸­ `\(\widehat{E D U_{i t}}\)` æ˜¯ `\(E D U_{i t}\)` ä¸ `\(e_{i t}\)` æ— å…³çš„éƒ¨åˆ†ã€‚é€šè¿‡å·¥å…·å˜é‡åˆ†è§£å‡º è‡ªå˜é‡ä¸­ä¸è¢« `\(e_{i t}\)` æ··æ·†çš„ä¿¡æ¯æ¥ä¼°è®¡è§£é‡Šå’Œå› å˜é‡çš„å› æœå…³ç³»ã€‚
    - å·¥å…·å˜é‡è¦ç¬¦åˆä¸¤ä¸ªæ¡ä»¶ï¼šå¤–ç”Ÿæ€§å’Œç›¸å…³æ€§
    - è¿™æ„å‘³ç€ `\(Z\)` å¯¹ `\(Y\)` çš„ä½œç”¨ `\(=Z\)` å¯¹ `\(X\)` çš„ä½œç”¨  `\(\times\)` `\(X\)` å¯¹ `\(Y\)` çš„ä½œç”¨

.center[
&lt;img src="https://pkuzzq-image.oss-cn-beijing.aliyuncs.com/uPic/t36Yi3.png" height="220"&gt;
]
---
### è§£å†³åŠæ³•

- å€˜è‹¥æ ·æœ¬ä»æ€»ä½“éšæœºæŠ½å–çš„ï¼Œä¼šå¯¼è‡´æ ·æœ¬é‡Œè‡ªå˜é‡å’Œä¸å¯è§‚æµ‹å› ç´  `\(e\)` å­˜åœ¨ç›¸å…³æ€§ã€‚ä¸‹å›¾åˆ»ç”»è¯¥æƒ…å½¢ã€‚
- ç”±äºæ ·æœ¬ä¸­åªåŒ…æ‹¬äº†å‚åŠ å·¥ä½œçš„ä¸ªä½“ï¼Œæ˜¯å¦å‚åŠ å·¥ä½œåˆ™æœ‰æ•ˆç”¨å˜é‡ Utility è¡¨ç¤ºã€‚

&lt;br/&gt;
.center[
&lt;img src="https://pkuzzq-image.oss-cn-beijing.aliyuncs.com/uPic/EEzLAW.png" height="230"&gt;
.center[.cap[å›¾ï¼šå¯¹æ’åè¯¯]]
]

---
### è§£å†³åŠæ³•å°ç»“

&lt;br&gt;&lt;br&gt;&lt;br&gt;
![MpdV2x](https://pkuzzq-image.oss-cn-beijing.aliyuncs.com/uPic/MpdV2x.png)
&lt;br&gt;

---
exclude: true


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": true,
"ratio": "16:10.85"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
